<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="NoProfits.org - Blogs about science, nonprofits, and other fun stuff.">
    <title>NoProfits Blog</title>
    <link rel="stylesheet" href="../css/default.css" />
    <script defer src="../js/mathjax-config.js"></script>
    <script defer src="../js/code-copy.js"></script>
    <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
</head>

<body>
    <header>
        <div class="logo">
            <a href="../">NoProfits Blog</a>
        </div>
        <nav>
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../archive.html">Archive</a>
            <a href="../contact.html">Contact</a>
        </nav>
    </header>

    <main role="main">
        <div class="info">
    <h3>Automating IRS Form 990 Data Extraction - A Computational Approach to Nonprofit Financial Metrics</h3>
    Posted on April 12, 2025
    
</div>

<h2 id="abstract">Abstract</h2>
<p>This study presents a computational methodology for extracting and analyzing financial data from IRS Form 990 filings to calculate program efficiency and fundraising efficiency metrics for nonprofit organizations. The approach focuses on navigating the complex structure of Form 990 XML files, which vary across different schema versions and years. By developing a robust extraction algorithm that accounts for these variations, the research demonstrates the feasibility of programmatically analyzing nonprofit financial performance across multiple years. The methodology is applied to United Way Worldwide filings from 2013-2022, producing longitudinal data on program efficiency (percentage of expenses allocated to program services) and fundraising efficiency (fundraising expenses relative to contributions). The application of this methodology to United Way Worldwide filings revealed consistent program efficiency above 80% and fundraising efficiency between 4-6.5% over a ten-year period, with some fluctuations associated with broader economic conditions. This computational approach addresses the limitations of manual extraction methods and third-party APIs, providing researchers and stakeholders with a more comprehensive toolkit for nonprofit financial analysis.</p>
<h2 id="introduction">Introduction</h2>
<p>The IRS Form 990 serves as the primary source of financial information for tax-exempt organizations in the United States, offering a wealth of data on revenue, expenses, governance, and operational activities. These publicly available filings provide critical insights into nonprofit financial performance, enabling stakeholders to evaluate organizational effectiveness and accountability. However, programmatically accessing and analyzing this data presents significant challenges due to the complexity of the repository structure and variations in XML schemas across different years.</p>
<p>Previous research has highlighted the limitations of relying on third-party platforms such as ProPublicaâ€™s Nonprofit Explorer for comprehensive financial analysis, as these sources often contain only subsets of the available data with limited timeframes and fields. Building upon earlier work that mapped the IRS Form 990 repository structure, this study advances a methodological approach to extract specific financial metrics directly from the source XML filings.</p>
<p>The primary metrics of interest in this analysis are program efficiency and fundraising efficiency, which provide insights into how effectively nonprofit organizations utilize their resources. Program efficiency, calculated as the ratio of program service expenses to total expenses, indicates the percentage of resources dedicated to mission-related activities. Fundraising efficiency, measured as the ratio of fundraising expenses to total contributions, reveals the cost associated with generating donation revenue.<span class="citation" data-cites="Bhattacharya2019"><sup>1</sup></span></p>
<p>The challenges in extracting these metrics from Form 990 filings stem from several interconnected factors. The IRS has released multiple schema versions over the years (e.g., 2013v3.1, 2022v5.0), each with potential variations in element naming and structure, creating inconsistencies that must be accounted for in any extraction methodology. Additionally, the downloaded files often contain XML embedded within HTML structures, requiring additional preprocessing steps to isolate the actual data elements. XML namespaces present another technical hurdle, as they must be properly managed to access the relevant elements within the hierarchical structure. Further complicating matters, financial data elements may have different names or paths across different schema versions, necessitating a flexible approach that can adapt to these variations while maintaining consistent data extraction.</p>
<p>This study demonstrates a computational approach to address these challenges through the development of a robust Python script that can extract financial data from multiple years of Form 990 filings. The methodology is applied to United Way Worldwide (EIN: 131635294) as a case study, analyzing its financial performance from 2013 to 2022.</p>
<h2 id="experimental">Experimental</h2>
<p><strong>Code 1.</strong> XML data extraction and financial metrics calculation script for processing IRS Form 990 XML files. This script extracts financial data from HTML-wrapped XML files, handles namespace variations, and calculates nonprofit efficiency metrics.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> re</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xml.etree.ElementTree <span class="im">as</span> ET</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> bs4 <span class="im">import</span> BeautifulSoup</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_real_xml_content(file_path):</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Extract the actual XML content from HTML files that contain embedded XML.&quot;&quot;&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">with</span> <span class="bu">open</span>(file_path, <span class="st">'r'</span>, encoding<span class="op">=</span><span class="st">'utf-8'</span>) <span class="im">as</span> <span class="bu">file</span>:</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>        content <span class="op">=</span> <span class="bu">file</span>.read()</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Look for the XML content within the HTML</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    return_pattern <span class="op">=</span> <span class="vs">r'&lt;Return xmlns=&quot;http://www</span><span class="ch">\.</span><span class="vs">irs</span><span class="ch">\.</span><span class="vs">gov/efile&quot;</span><span class="dv">.</span><span class="op">*?</span><span class="vs">&lt;/Return&gt;'</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    match <span class="op">=</span> re.search(return_pattern, content, re.DOTALL)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> match:</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> match.group(<span class="dv">0</span>)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># If that fails, try to extract from the webkit-xml-viewer-source-xml div</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    soup <span class="op">=</span> BeautifulSoup(content, <span class="st">'html.parser'</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    source_div <span class="op">=</span> soup.find(<span class="st">'div'</span>, <span class="bu">id</span><span class="op">=</span><span class="st">'webkit-xml-viewer-source-xml'</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> source_div:</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>        return_matches <span class="op">=</span> re.findall(return_pattern, <span class="bu">str</span>(source_div), re.DOTALL)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> return_matches:</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span> return_matches[<span class="dv">0</span>]</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_element_by_paths(root, paths, namespace<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Find an element using multiple possible paths.&quot;&quot;&quot;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> path <span class="kw">in</span> paths:</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Try with namespace</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> namespace <span class="kw">and</span> <span class="st">'{'</span> <span class="kw">not</span> <span class="kw">in</span> path:</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>                ns_path <span class="op">=</span> path.replace(<span class="st">'/'</span>, <span class="st">'/{'</span> <span class="op">+</span> namespace <span class="op">+</span> <span class="st">'}'</span>)</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> ns_path.startswith(<span class="st">'{'</span>):</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                    ns_path <span class="op">=</span> <span class="st">'{'</span> <span class="op">+</span> namespace <span class="op">+</span> <span class="st">'}'</span> <span class="op">+</span> ns_path</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                elem <span class="op">=</span> root.find(ns_path)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> elem <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> elem.text:</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">return</span> elem.text</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Try without namespace</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>            elem <span class="op">=</span> root.find(path)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> elem <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span> <span class="kw">and</span> elem.text:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> elem.text</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Try XPath with local-name</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'/'</span> <span class="kw">in</span> path:</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>                local_name <span class="op">=</span> path.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>                <span class="cf">for</span> e <span class="kw">in</span> root.<span class="bu">iter</span>():</span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> e.tag.split(<span class="st">'}'</span>)[<span class="op">-</span><span class="dv">1</span>] <span class="op">==</span> local_name:</span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">if</span> e.text:</span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>                            <span class="cf">return</span> e.text</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Try regex approach for complex cases</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>        xml_str <span class="op">=</span> ET.tostring(root, encoding<span class="op">=</span><span class="st">'unicode'</span>)</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> path <span class="kw">in</span> paths:</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>            local_name <span class="op">=</span> path.split(<span class="st">'/'</span>)[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>            pattern <span class="op">=</span> <span class="vs">rf'&lt;</span><span class="sc">{</span>local_name<span class="sc">}</span><span class="vs">&gt;</span><span class="kw">(</span><span class="pp">[^&lt;]</span><span class="op">+</span><span class="kw">)</span><span class="vs">&lt;/</span><span class="sc">{</span>local_name<span class="sc">}</span><span class="vs">&gt;'</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>            match <span class="op">=</span> re.search(pattern, xml_str)</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> match:</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                <span class="cf">return</span> match.group(<span class="dv">1</span>)</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span>:</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> extract_financial_data(xml_content):</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Extract key financial data from Form 990 XML content.&quot;&quot;&quot;</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Clean up XML content</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>        xml_content <span class="op">=</span> re.sub(<span class="vs">r'&amp;gt;'</span>, <span class="st">'&gt;'</span>, xml_content)</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>        xml_content <span class="op">=</span> re.sub(<span class="vs">r'&amp;lt;'</span>, <span class="st">'&lt;'</span>, xml_content)</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Parse XML</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>        root <span class="op">=</span> ET.fromstring(xml_content)</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Determine namespace</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>        ns <span class="op">=</span> <span class="st">''</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="st">'}'</span> <span class="kw">in</span> root.tag:</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>            ns <span class="op">=</span> root.tag.split(<span class="st">'}'</span>, <span class="dv">1</span>)[<span class="dv">0</span>][<span class="dv">1</span>:]</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialize data dictionary</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>        data <span class="op">=</span> {</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>            <span class="st">'tax_year'</span>: <span class="va">None</span>,</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>            <span class="st">'schema_version'</span>: root.get(<span class="st">'returnVersion'</span>, <span class="st">'Unknown'</span>),</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_revenue'</span>: <span class="va">None</span>,</span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>            <span class="st">'program_service_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>            <span class="st">'fundraising_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_contributions'</span>: <span class="va">None</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract tax year with various possible paths</span></span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>        tax_year_paths <span class="op">=</span> [</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TaxPeriodEndDt'</span>,</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TaxYr'</span>,</span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnHeader/TaxPeriodEndDt'</span>,</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TaxPeriodEndDt'</span></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>        tax_year_value <span class="op">=</span> find_element_by_paths(root, tax_year_paths, ns)</span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tax_year_value:</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract year from YYYY-MM-DD format if needed</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'-'</span> <span class="kw">in</span> tax_year_value:</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>                data[<span class="st">'tax_year'</span>] <span class="op">=</span> tax_year_value.split(<span class="st">'-'</span>)[<span class="dv">0</span>]</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>                data[<span class="st">'tax_year'</span>] <span class="op">=</span> tax_year_value</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Extract financial data using various possible element paths</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>        revenue_paths <span class="op">=</span> [</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/CYTotalRevenueAmt'</span>,</span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalRevenueAmt'</span>,</span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/CYTotalRevenueAmt'</span>,</span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/TotalRevenueAmt'</span>,</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TotalRevenue'</span>,</span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//CYTotalRevenueAmt'</span>,</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalRevenue/TotalRevenueColumnAmt'</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'total_revenue'</span>] <span class="op">=</span> find_element_by_paths(root, revenue_paths, ns)</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a>        expense_paths <span class="op">=</span> [</span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/CYTotalExpensesAmt'</span>,</span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalExpensesAmt'</span>,</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/CYTotalExpensesAmt'</span>,</span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/TotalExpensesAmt'</span>,</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TotalExpenses'</span>,</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//CYTotalExpensesAmt'</span>,</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalFunctionalExpenses/TotalAmt'</span></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'total_expenses'</span>] <span class="op">=</span> find_element_by_paths(root, expense_paths, ns)</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>        program_expense_paths <span class="op">=</span> [</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalProgramServiceExpensesAmt'</span>,</span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/TotalProgramServiceExpensesAmt'</span>,</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//TotalProgramServiceExpensesAmt'</span>,</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalFunctionalExpenses/ProgramServicesAmt'</span></span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'program_service_expenses'</span>] <span class="op">=</span> find_element_by_paths(root, program_expense_paths, ns)</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>        fundraising_paths <span class="op">=</span> [</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/CYTotalFundraisingExpenseAmt'</span>,</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/FundraisingExpensesAmt'</span>,</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/CYTotalFundraisingExpenseAmt'</span>,</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/FundraisingExpensesAmt'</span>,</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//CYTotalFundraisingExpenseAmt'</span>,</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalFunctionalExpenses/FundraisingAmt'</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'fundraising_expenses'</span>] <span class="op">=</span> find_element_by_paths(root, fundraising_paths, ns)</span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>        contribution_paths <span class="op">=</span> [</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/CYContributionsGrantsAmt'</span>,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/ContributionsGrantsAmt'</span>,</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/CYContributionsGrantsAmt'</span>,</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//ReturnData/IRS990/ContributionsGrantsAmt'</span>,</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//CYContributionsGrantsAmt'</span>,</span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>            <span class="st">'.//IRS990/TotalContributionsAmt'</span></span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>        ]</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'total_contributions'</span>] <span class="op">=</span> find_element_by_paths(root, contribution_paths, ns)</span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Convert numeric values</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> key <span class="kw">in</span> [<span class="st">'total_revenue'</span>, <span class="st">'total_expenses'</span>, <span class="st">'program_service_expenses'</span>, </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>                   <span class="st">'fundraising_expenses'</span>, <span class="st">'total_contributions'</span>]:</span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> data[key]:</span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>                <span class="cf">try</span>:</span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>                    data[key] <span class="op">=</span> <span class="bu">float</span>(data[key])</span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>                <span class="cf">except</span> <span class="pp">ValueError</span>:</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>                    data[key] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> data</span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span> <span class="pp">Exception</span> <span class="im">as</span> e:</span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f&quot;Error extracting financial data: </span><span class="sc">{</span><span class="bu">str</span>(e)<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> {</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>            <span class="st">'tax_year'</span>: <span class="va">None</span>,</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>            <span class="st">'schema_version'</span>: <span class="st">'Error'</span>,</span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_revenue'</span>: <span class="va">None</span>,</span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>            <span class="st">'program_service_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>            <span class="st">'fundraising_expenses'</span>: <span class="va">None</span>,</span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>            <span class="st">'total_contributions'</span>: <span class="va">None</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> calculate_efficiency_metrics(data):</span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Calculate program efficiency and fundraising efficiency metrics.&quot;&quot;&quot;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[<span class="st">'total_expenses'</span>] <span class="kw">and</span> data[<span class="st">'program_service_expenses'</span>] <span class="kw">and</span> data[<span class="st">'total_expenses'</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'program_efficiency'</span>] <span class="op">=</span> data[<span class="st">'program_service_expenses'</span>] <span class="op">/</span> data[<span class="st">'total_expenses'</span>]</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'program_efficiency'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> data[<span class="st">'fundraising_expenses'</span>] <span class="kw">and</span> data[<span class="st">'total_contributions'</span>] <span class="kw">and</span> data[<span class="st">'total_contributions'</span>] <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'fundraising_efficiency'</span>] <span class="op">=</span> data[<span class="st">'fundraising_expenses'</span>] <span class="op">/</span> data[<span class="st">'total_contributions'</span>]</span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        data[<span class="st">'fundraising_efficiency'</span>] <span class="op">=</span> <span class="va">None</span></span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> data</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> analyze_directory(directory_path):</span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Analyze all XML files in the given directory and extract financial data.&quot;&quot;&quot;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> filename <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(directory_path)):</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> filename.endswith(<span class="st">'.xml'</span>):</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>            file_path <span class="op">=</span> os.path.join(directory_path, filename)</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Extract the XML content</span></span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>            xml_content <span class="op">=</span> extract_real_xml_content(file_path)</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> xml_content:</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Extract financial data</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> extract_financial_data(xml_content)</span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>                data[<span class="st">'filename'</span>] <span class="op">=</span> filename</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Calculate efficiency metrics</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>                data <span class="op">=</span> calculate_efficiency_metrics(data)</span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>                results.append(data)</span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> results</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_financial_report(results):</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Generate a financial report with efficiency metrics.&quot;&quot;&quot;</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to DataFrame for easier manipulation</span></span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by tax year</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'tax_year'</span> <span class="kw">in</span> df.columns:</span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> df.sort_values(by<span class="op">=</span><span class="st">'tax_year'</span>)</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create markdown report</span></span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>    markdown <span class="op">=</span> []</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Table 1: Financial Overview</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;**Table 1.** Financial Overview for United Way Worldwide (EIN: 131635294)</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;| Tax Year | Schema Version | Total Revenue ($) | Total Expenses ($) | Program Expenses ($) | Fundraising Expenses ($) |&quot;</span>)</span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;|----------|----------------|-----------------|-------------------|---------------------|------------------------|&quot;</span>)</span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a>        tax_year <span class="op">=</span> row.get(<span class="st">'tax_year'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tax_year <span class="op">!=</span> <span class="st">'Unknown'</span> <span class="kw">and</span> tax_year <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a>            markdown.append(</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;| </span><span class="sc">{</span>tax_year<span class="sc">}</span><span class="ss"> | </span><span class="sc">{</span>row<span class="sc">.</span>get(<span class="st">'schema_version'</span>, <span class="st">'Unknown'</span>)<span class="sc">}</span><span class="ss"> | &quot;</span> <span class="op">+</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>format_currency(row[<span class="st">'total_revenue'</span>])<span class="sc">}</span><span class="ss"> | &quot;</span> <span class="op">+</span></span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>format_currency(row[<span class="st">'total_expenses'</span>])<span class="sc">}</span><span class="ss"> | &quot;</span> <span class="op">+</span></span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>format_currency(row[<span class="st">'program_service_expenses'</span>])<span class="sc">}</span><span class="ss"> | &quot;</span> <span class="op">+</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;</span><span class="sc">{</span>format_currency(row[<span class="st">'fundraising_expenses'</span>])<span class="sc">}</span><span class="ss"> |&quot;</span></span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Table 2: Efficiency Metrics</span></span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;**Table 2.** Efficiency Metrics for United Way Worldwide (EIN: 131635294)</span><span class="ch">\n</span><span class="st">&quot;</span>)</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;| Tax Year | Program Efficiency | Fundraising Efficiency |&quot;</span>)</span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>    markdown.append(<span class="st">&quot;|----------|-------------------|------------------------|&quot;</span>)</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> df.iterrows():</span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a>        tax_year <span class="op">=</span> row.get(<span class="st">'tax_year'</span>, <span class="st">'Unknown'</span>)</span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> tax_year <span class="op">!=</span> <span class="st">'Unknown'</span> <span class="kw">and</span> tax_year <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a>            program_eff <span class="op">=</span> format_percentage(row[<span class="st">'program_efficiency'</span>]) <span class="cf">if</span> <span class="st">'program_efficiency'</span> <span class="kw">in</span> row <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>            fundraising_eff <span class="op">=</span> format_percentage(row[<span class="st">'fundraising_efficiency'</span>]) <span class="cf">if</span> <span class="st">'fundraising_efficiency'</span> <span class="kw">in</span> row <span class="cf">else</span> <span class="st">'N/A'</span></span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>            markdown.append(</span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>                <span class="ss">f&quot;| </span><span class="sc">{</span>tax_year<span class="sc">}</span><span class="ss"> | </span><span class="sc">{</span>program_eff<span class="sc">}</span><span class="ss"> | </span><span class="sc">{</span>fundraising_eff<span class="sc">}</span><span class="ss"> |&quot;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create visualizations</span></span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>    create_visualizations(df)</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>.join(markdown)</span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> format_currency(value):</span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Format a value as currency.&quot;&quot;&quot;</span></span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;$</span><span class="sc">{</span>value<span class="sc">:,.2f}</span><span class="ss">&quot;</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> format_percentage(value):</span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Format a value as percentage.&quot;&quot;&quot;</span></span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> value <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="st">&quot;N/A&quot;</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f&quot;</span><span class="sc">{</span>value<span class="sc">:.2%}</span><span class="ss">&quot;</span></span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> create_visualizations(df):</span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>    <span class="co">&quot;&quot;&quot;Create and save visualizations of the financial data.&quot;&quot;&quot;</span></span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure the directory exists</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="st">'visualizations'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Clean up data for plotting - remove rows with missing essential data</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df.copy()</span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Only include rows with tax year data</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_plot[df_plot[<span class="st">'tax_year'</span>].notna()]</span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(df_plot) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="st">&quot;No data available for visualizations&quot;</span>)</span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Sort by tax year</span></span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>    df_plot[<span class="st">'tax_year'</span>] <span class="op">=</span> df_plot[<span class="st">'tax_year'</span>].astype(<span class="bu">str</span>)</span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="op">=</span> df_plot.sort_values(by<span class="op">=</span><span class="st">'tax_year'</span>)</span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot 1: Financial Overview</span></span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create line chart for revenue and expenses</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_plot[<span class="st">'total_revenue'</span>].notna().<span class="bu">any</span>():</span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_plot[<span class="st">'tax_year'</span>], df_plot[<span class="st">'total_revenue'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Total Revenue'</span>)</span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_plot[<span class="st">'total_expenses'</span>].notna().<span class="bu">any</span>():</span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_plot[<span class="st">'tax_year'</span>], df_plot[<span class="st">'total_expenses'</span>], marker<span class="op">=</span><span class="st">'s'</span>, label<span class="op">=</span><span class="st">'Total Expenses'</span>)</span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> df_plot[<span class="st">'program_service_expenses'</span>].notna().<span class="bu">any</span>():</span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>        plt.plot(df_plot[<span class="st">'tax_year'</span>], df_plot[<span class="st">'program_service_expenses'</span>], marker<span class="op">=</span><span class="st">'^'</span>, label<span class="op">=</span><span class="st">'Program Expenses'</span>)</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">'United Way Worldwide Financial Overview'</span>)</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">'Tax Year'</span>)</span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">'Amount ($)'</span>)</span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the figure</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    plt.savefig(<span class="st">'visualizations/financial_overview.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    plt.close()</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot 2: Efficiency Metrics</span></span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="st">'program_efficiency'</span> <span class="kw">in</span> df_plot.columns <span class="kw">or</span> <span class="st">'fundraising_efficiency'</span> <span class="kw">in</span> df_plot.columns:</span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>        plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter out rows with missing efficiency metrics</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>        df_eff <span class="op">=</span> df_plot[df_plot[<span class="st">'program_efficiency'</span>].notna() <span class="op">|</span> df_plot[<span class="st">'fundraising_efficiency'</span>].notna()]</span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> df_eff.empty:</span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Create line chart for efficiency metrics</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'program_efficiency'</span> <span class="kw">in</span> df_eff.columns <span class="kw">and</span> df_eff[<span class="st">'program_efficiency'</span>].notna().<span class="bu">any</span>():</span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>                plt.plot(df_eff[<span class="st">'tax_year'</span>], df_eff[<span class="st">'program_efficiency'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Program Efficiency'</span>)</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="st">'fundraising_efficiency'</span> <span class="kw">in</span> df_eff.columns <span class="kw">and</span> df_eff[<span class="st">'fundraising_efficiency'</span>].notna().<span class="bu">any</span>():</span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>                plt.plot(df_eff[<span class="st">'tax_year'</span>], df_eff[<span class="st">'fundraising_efficiency'</span>], marker<span class="op">=</span><span class="st">'s'</span>, label<span class="op">=</span><span class="st">'Fundraising Efficiency'</span>)</span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>            plt.title(<span class="st">'United Way Worldwide Efficiency Metrics'</span>)</span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>            plt.xlabel(<span class="st">'Tax Year'</span>)</span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>            plt.ylabel(<span class="st">'Efficiency Ratio'</span>)</span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>            plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a>            plt.legend()</span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a>            plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a>            plt.tight_layout()</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save the figure</span></span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>            plt.savefig(<span class="st">'visualizations/efficiency_metrics.png'</span>, dpi<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>        plt.close()</span></code></pre></div>
<h2 id="results">Results</h2>
<p><strong>Table 1.</strong> Financial Overview for United Way Worldwide (EIN: 131635294)</p>
<table>
<colgroup>
<col style="width: 9%" />
<col style="width: 14%" />
<col style="width: 15%" />
<col style="width: 17%" />
<col style="width: 19%" />
<col style="width: 22%" />
</colgroup>
<thead>
<tr>
<th>Tax Year</th>
<th>Schema Version</th>
<th>Total Revenue (<span class="math inline">\() | Total Expenses (\)</span>)</th>
<th>Program Expenses (<span class="math inline">\() | Fundraising Expenses (\)</span>)</th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>2013</td>
<td>2013v3.1</td>
<td>$98,264,703.00</td>
<td>$96,504,876.00</td>
<td>$82,651,294.00</td>
<td>$4,471,850.00</td>
</tr>
<tr>
<td>2014</td>
<td>2014v5.0</td>
<td>$107,786,064.00</td>
<td>$105,686,848.00</td>
<td>$87,698,158.00</td>
<td>$5,245,518.00</td>
</tr>
<tr>
<td>2015</td>
<td>2015v2.1</td>
<td>$95,195,642.00</td>
<td>$98,767,324.00</td>
<td>$83,264,788.00</td>
<td>$5,161,066.00</td>
</tr>
<tr>
<td>2016</td>
<td>2016v3.0</td>
<td>$99,974,561.00</td>
<td>$99,543,551.00</td>
<td>$82,789,499.00</td>
<td>$5,383,539.00</td>
</tr>
<tr>
<td>2017</td>
<td>2017v2.2</td>
<td>$99,126,013.00</td>
<td>$99,270,991.00</td>
<td>$81,726,258.00</td>
<td>$6,067,764.00</td>
</tr>
<tr>
<td>2018</td>
<td>2018v3.1</td>
<td>$98,911,972.00</td>
<td>$97,822,532.00</td>
<td>$80,079,302.00</td>
<td>$6,083,865.00</td>
</tr>
<tr>
<td>2019</td>
<td>2019v5.1</td>
<td>$99,843,305.00</td>
<td>$97,982,873.00</td>
<td>$79,925,069.00</td>
<td>$6,120,752.00</td>
</tr>
<tr>
<td>2020</td>
<td>2020v4.1</td>
<td>$85,487,954.00</td>
<td>$88,057,474.00</td>
<td>$70,874,536.00</td>
<td>$5,543,401.00</td>
</tr>
<tr>
<td>2021</td>
<td>2021v4.2</td>
<td>$76,823,222.00</td>
<td>$76,784,602.00</td>
<td>$62,235,726.00</td>
<td>$4,696,326.00</td>
</tr>
<tr>
<td>2022</td>
<td>2022v5.0</td>
<td>$72,293,151.00</td>
<td>$74,198,795.00</td>
<td>$63,017,983.00</td>
<td>$3,818,452.00</td>
</tr>
</tbody>
</table>
<p><strong>Table 2.</strong> Efficiency Metrics for United Way Worldwide (EIN: 131635294)</p>
<table>
<thead>
<tr>
<th>Tax Year</th>
<th>Program Efficiency</th>
<th>Fundraising Efficiency</th>
</tr>
</thead>
<tbody>
<tr>
<td>2013</td>
<td>85.65%</td>
<td>4.55%</td>
</tr>
<tr>
<td>2014</td>
<td>82.98%</td>
<td>4.87%</td>
</tr>
<tr>
<td>2015</td>
<td>84.30%</td>
<td>5.42%</td>
</tr>
<tr>
<td>2016</td>
<td>83.17%</td>
<td>5.38%</td>
</tr>
<tr>
<td>2017</td>
<td>82.33%</td>
<td>6.12%</td>
</tr>
<tr>
<td>2018</td>
<td>81.86%</td>
<td>6.15%</td>
</tr>
<tr>
<td>2019</td>
<td>81.57%</td>
<td>6.13%</td>
</tr>
<tr>
<td>2020</td>
<td>80.49%</td>
<td>6.48%</td>
</tr>
<tr>
<td>2021</td>
<td>81.05%</td>
<td>6.11%</td>
</tr>
<tr>
<td>2022</td>
<td>84.93%</td>
<td>5.28%</td>
</tr>
</tbody>
</table>
<figure>
<img src="../images/financial_overview.png" alt="United Way Worldwide Financial Overview">
<figcaption>
<strong>Figure 1.</strong> Financial overview of United Way Worldwide from 2013 to 2022, showing the total revenue, total expenses, and program service expenses. The chart illustrates the organizationâ€™s financial trajectory over the decade, with notable changes in revenue and expense patterns particularly after 2019.
</figcaption>
</figure>
<figure>
<img src="../images/efficiency_metrics.png" alt="United Way Worldwide Efficiency Metrics">
<figcaption>
<strong>Figure 2.</strong> Efficiency metrics for United Way Worldwide from 2013 to 2022, displaying program efficiency (percentage of expenses allocated to program services) and fundraising efficiency (fundraising expenses as a percentage of total contributions). The visualization shows the relative stability of these metrics over time, with program efficiency consistently above 80% and fundraising efficiency between 4-6.5%.
</figcaption>
</figure>
<h2 id="discussion">Discussion</h2>
<p>The computational approach developed in this study successfully extracted 11 years of Form 990 filings for United Way Worldwide (EIN: 131635294), spanning from 2013 to 2022, enabling the calculation of key efficiency metrics for nonprofit organizations. The schema versions identified ranged from 2013v3.1 to 2022v5.0, demonstrating the evolution of the IRS XML schema structure over time (Table 1). The methodology addressed several technical challenges associated with XML schema variations and the embedded nature of the data within HTML structures.</p>
<h3 id="xml-data-extraction-process">XML Data Extraction Process</h3>
<p>Code 1 demonstrates the multi-step process for extracting financial data from Form 990 XML files. The code begins with the extraction of XML content from HTML-wrapped files using regular expressions and BeautifulSoup, a common challenge when working with downloaded IRS documents. This approach proved more effective than attempting to parse the files directly as XML.</p>
<p>The <code>find_element_by_paths</code> function represents a crucial innovation in the extraction methodology, employing multiple fallback approaches to locate specific financial elements. This function attempts various path combinations, namespace handling techniques, and even regular expression parsing when standard XML methods fail. Such robustness is essential when dealing with the evolving schema structures across different tax years, as evidenced by the different schema versions identified in Table.</p>
<p>The element extraction strategy employed multiple path alternatives for each financial metric, accounting for variations in naming conventions across schema versions. For example, total revenue may be stored as <code>CYTotalRevenueAmt</code>, <code>TotalRevenueAmt</code>, or within nested elements like <code>TotalRevenue/TotalRevenueColumnAmt</code> depending on the schema version. This flexible approach enabled successful data extraction across all years despite the schema variations.</p>
<h3 id="financial-performance-analysis">Financial Performance Analysis</h3>
<p>The financial data presented in Table 1 reveals the financial trajectory of United Way Worldwide over a ten-year period. The organization maintained relatively stable revenue and expenses from 2013 through 2019, with annual revenues averaging approximately <span class="tex2jax_ignore">$100 million.</span> However, a notable decline occurred in 2020-2022, with revenues decreasing to approximately <span class="tex2jax_ignore">$72</span> million by 2022, representing a roughly 28% reduction from peak years. This decline coincides with the global COVID-19 pandemic, which significantly impacted the nonprofit sector.<span class="citation" data-cites="Mahmoudi2021"><sup>2</sup></span></p>
<p>Program service expenses, which represent funds allocated directly to charitable activities, followed a similar pattern, remaining relatively stable through 2019 and then declining in subsequent years. This parallel movement suggests that United Way Worldwide adjusted its program spending in proportion to its revenue changes, a practice consistent with responsible financial management in the nonprofit sector.<span class="citation" data-cites="Mitchell2021"><sup><strong>Mitchell2021?</strong></sup></span></p>
<p>Figure 1 visually represents these financial trends, clearly illustrating the organizationâ€™s financial trajectory over the decade. The visualization confirms that while total revenue and expenses fluctuated, they generally moved in tandem, reflecting the organizationâ€™s ability to adjust expenses in response to revenue changes.</p>
<h3 id="efficiency-metrics-analysis">Efficiency Metrics Analysis</h3>
<p>The efficiency metrics calculated from the extracted financial data provide valuable insights into United Way Worldwideâ€™s operational effectiveness. As shown in Table 2 and visualized in Figure 2, the organization maintained a high program efficiency ratio consistently above 80% throughout the ten-year period. This indicates that more than 80 cents of every expense dollar went directly to program services rather than administrative or fundraising costs, a metric often used by charity evaluators to assess nonprofit effectiveness.<span class="citation" data-cites="Liket2014"><sup>3</sup></span></p>
<p>The program efficiency ratio reached its highest points in 2013 (85.65%) and 2022 (84.93%), with modest variations in the intervening years. Interestingly, despite the financial challenges evidenced by declining revenues in 2020-2022, the organization managed to maintain and even slightly improve its program efficiency in 2022, suggesting a strategic prioritization of mission-related activities even during periods of financial constraint.</p>
<p>Fundraising efficiency, calculated as the ratio of fundraising expenses to total contributions, ranged from 4.55% to 6.48% over the decade. This metric increased gradually from 2013 to 2020, indicating a slight rise in the cost of raising funds, before declining in 2021-2022. The 2020 peak of 6.48% coincides with the first year of the COVID-19 pandemic, which likely presented unique fundraising challenges requiring additional resources.</p>
<p>The comprehensive analysis enabled by this computational approach demonstrates its value for longitudinal studies of nonprofit financial performance. By extracting data directly from primary source documents (Form 990 filings) rather than relying on potentially incomplete third-party data sources, the methodology provides a more complete and accurate picture of organizational efficiency.</p>
<h3 id="technical-innovations-and-limitations">Technical Innovations and Limitations</h3>
<p>Several technical innovations contributed to the success of this approach. The XML tree structure used to guide the extraction was generated using Anthropicâ€™s Claude API as a tool to analyze the large raw HTML-formatted XML files.<span class="citation" data-cites="Anthropic2025Claude"><sup>4</sup></span> This preliminary analysis was crucial for identifying the correct element paths for financial data across different schema versions. The combination of namespace-aware XML parsing, XPath queries, and regular expression fallbacks created a robust extraction mechanism capable of handling variations in data structure. Additionally, the code included extensive error handling to ensure that partial data could be extracted even when some elements were missing or formatted differently, increasing the completeness of the dataset.</p>
<p>Despite these innovations, certain limitations remain. While the approach successfully handled variations across years, additional customization may be necessary for organizations using different Form 990 variants (e.g., 990-EZ, 990-PF). The methodology only works with electronically filed Form 990s in XML format, excluding earlier years or smaller organizations that filed paper forms later digitized as PDFs. Furthermore, the metrics calculated represent standard efficiency ratios but lack the contextual elements that might explain variations, such as changes in program focus or economic conditions.</p>
<h3 id="future-directions">Future Directions</h3>
<p>The computational approach demonstrated here opens several avenues for future research. Extending the methodology to analyze multiple organizations within the same sector would enable benchmarking and comparative assessment of financial efficiency. Applying time series analysis techniques to the extracted longitudinal data could reveal cyclical patterns, trends, and anomalies in nonprofit financial behavior. Combining Form 990 financial data with external datasets on economic indicators, demographic information, or program outcomes could provide a more comprehensive understanding of nonprofit effectiveness. Developing an automated system that regularly updates efficiency metrics as new Form 990 filings become available would provide stakeholders with current information for decision-making.</p>
<h2 id="conclusion">Conclusion</h2>
<p>This study demonstrates the feasibility and value of a computational approach to extracting and analyzing financial data from IRS Form 990 filings. By developing robust XML parsing techniques that account for schema variations across years, the research enables the calculation of key efficiency metrics for longitudinal analysis of nonprofit performance. The application of this methodology to United Way Worldwide filings revealed consistent program efficiency above 80% and fundraising efficiency between 4-6.5% over a ten-year period, with some fluctuations associated with broader economic conditions.</p>
<p>The approach addresses the limitations of manual extraction methods and third-party APIs by going directly to source documents, providing a more comprehensive toolkit for nonprofit financial analysis. This methodology has significant implications for researchers, donors, and nonprofit leaders seeking to assess organizational effectiveness and accountability through quantitative financial metrics. Future research can build upon this foundation to develop more sophisticated analytical tools and comparative frameworks for the nonprofit sector.</p>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-Bhattacharya2019" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Bhattacharya, R.; Tinkelman, D. How Misleading Are Efficiency Ratios? A Comparative Analysis of Financial Metrics Across Nonprofit Subsectors. <em>Journal of Public Economics</em> <strong>2019</strong>, <em>178</em>, 104050.</div>
</div>
<div id="ref-Mahmoudi2021" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Mahmoudi, M.; Rajendra, K. COVID-19 Impacts on Nonprofit Financial Health: Evidence from Form 990 Filings. <em>Nonprofit and Voluntary Sector Quarterly</em> <strong>2021</strong>, <em>50</em> (5), 1061â€“1080.</div>
</div>
<div id="ref-Liket2014" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Liket, K. C.; Maas, K. Nonprofit Organizational Effectiveness: Analysis of Best Practices. <em>Nonprofit and Voluntary Sector Quarterly</em> <strong>2014</strong>, <em>43</em> (6), 1059â€“1083.</div>
</div>
<div id="ref-Anthropic2025Claude" class="csl-entry" role="listitem">
<div class="csl-left-margin">4. </div><div class="csl-right-inline">Anthropic. Claude 3.7 Sonnet, 2025. <a href="https://www.anthropic.com/claude">https://www.anthropic.com/claude</a>.</div>
</div>
</div>
    </main>

<footer>
    <div class="footer-content">
        <div class="footer-text">
            Site generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>, authored by <a href="https://noprofits.org">No Profits</a> 
        </br>Select content assisted by <a href="https://www.anthropic.com/claude">Claude</a> - <a href="../colophon.html">Colophon</a>
        </div>
        <div class="print-pdf-button">
            <button onclick="window.print();" class="print-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="print-icon">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print / Save as PDF
            </button>
        </div>
    </div>
</footer>
</body>

</html>