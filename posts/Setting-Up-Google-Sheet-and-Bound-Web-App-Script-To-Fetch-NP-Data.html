<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="NoProfits.org - Blogs about science, nonprofits, and other fun stuff.">
    <title>NoProfits Blog</title>
    <link rel="stylesheet" href="../css/default.css" />
    <script defer src="../js/mathjax-config.js"></script>
    <script defer src="../js/code-copy.js"></script>
    <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
</head>

<body>
    <header>
        <div class="logo">
            <a href="../">NoProfits Blog</a>
        </div>
        <nav>
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../archive.html">Archive</a>
            <a href="../contact.html">Contact</a>
        </nav>
    </header>

    <main role="main">
        <div class="info">
    <h3>Building a Spreadsheet-Based API Tool with Google Sheets</h3>
    Posted on May  3, 2025
    
</div>

<h1 id="abstract">Abstract</h1>
<p>This project demonstrates how Google Sheets combined with Google Apps Script can overcome limitations found in Excel’s free online version by enabling direct API connectivity. I developed a spreadsheet system that connects to the ProPublica Nonprofit Explorer API to retrieve financial data for organizations based on their Employer Identification Number (EIN). The solution includes a custom menu in the spreadsheet and a web app interface that allows users without Google accounts to access the functionality. By implementing this data retrieval system using Google’s free tools, I showcase how users can automate complex data operations without premium spreadsheet subscriptions. The approach serves as a practical template for connecting spreadsheets to various data sources through APIs, opening possibilities for enhanced data analysis within free cloud-based spreadsheet platforms.</p>
<h1 id="introduction">Introduction</h1>
<p>Spreadsheet applications remain essential tools for data analysis, but their capabilities vary significantly between paid and free versions. The free online version of Excel notably restricts users from connecting to external data sources through APIs, limiting automation possibilities for data collection and analysis. This constraint poses challenges for users who need regular access to external data but lack the resources for premium spreadsheet solutions.</p>
<p>Google Sheets, combined with Google Apps Script, offers a compelling alternative by providing free access to API connectivity. Google Apps Script, a JavaScript-based scripting platform integrated with Google Workspace, enables users to extend spreadsheet functionality through custom code. This capability addresses a critical gap in free spreadsheet offerings: the ability to programmatically retrieve data from external sources.</p>
<p>This study demonstrates this advantage by developing a system that connects to the ProPublica Nonprofit Explorer API. This API provides structured financial data from IRS Form 990 filings for tax-exempt organizations, delivering information in JSON format when queried with an organization’s EIN.<span class="citation" data-cites="ProPublica2025"><sup>1</sup></span> While the nonprofit sector serves as our test case, the methodology applies broadly to any scenario requiring spreadsheet integration with external data sources.</p>
<p>Our implementation includes two key components: a script bound to a Google Workbook that handles API requests and data processing, and a web app deployment that extends accessibility beyond Google account holders. This dual-interface approach showcases how Google’s ecosystem can support both internal and external data workflows without additional licensing costs. By documenting this process, I provide a practical framework for overcoming limitations in free spreadsheet applications, empowering users to create more sophisticated data solutions without financial barriers.</p>
<h1 id="experimental">Experimental</h1>
<p>Code 1. Google Apps Script for fetching and processing nonprofit data from the ProPublica API, including functions for workbook manipulation and custom menu integration.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Configuration <span class="bu">object</span> to avoid redeclaration issues</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>var Config <span class="op">=</span> {</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  API_BASE_URL: <span class="st">&quot;https://projects.propublica.org/nonprofits/api/v2/organizations/&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>}<span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Serves the web app HTML interface</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>function doGet() {</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> HtmlService.createHtmlOutput(</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;!DOCTYPE html&gt;'</span> <span class="op">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;html&gt;'</span> <span class="op">+</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;head&gt;'</span> <span class="op">+</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;title&gt;Nonprofit Data Fetcher&lt;/title&gt;'</span> <span class="op">+</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;style&gt;'</span> <span class="op">+</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">'body { font-family: Arial, sans-serif; margin: 20px; }'</span> <span class="op">+</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">'h2 { color: #4285F4; }'</span> <span class="op">+</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">'.form-container { max-width: 400px; }'</span> <span class="op">+</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">'input[type=&quot;text&quot;] { width: 100%; padding: 8px; margin: 10px 0; }'</span> <span class="op">+</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">'input[type=&quot;submit&quot;] { background-color: #4285F4; color: white; padding: 10px 20px; border: none; cursor: pointer; }'</span> <span class="op">+</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">'input[type=&quot;submit&quot;]:hover { background-color: #357AE8; }'</span> <span class="op">+</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">'#result { margin-top: 20px; color: #333; }'</span> <span class="op">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'.error { color: red; }'</span> <span class="op">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">'table { border-collapse: collapse; width: 100%; margin-top: 20px; }'</span> <span class="op">+</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">'th, td { border: 1px solid #ddd; padding: 8px; text-align: right; }'</span> <span class="op">+</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">'th { background-color: #D9EAD3; font-weight: bold; }'</span> <span class="op">+</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tr:nth-child(even) { background-color: #F3F3F3; }'</span> <span class="op">+</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">'tr:nth-child(odd) { background-color: #E6F2FF; }'</span> <span class="op">+</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">'.org-info { font-weight: bold; margin-bottom: 10px; }'</span> <span class="op">+</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/style&gt;'</span> <span class="op">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/head&gt;'</span> <span class="op">+</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;body&gt;'</span> <span class="op">+</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;h2&gt;Fetch Nonprofit Data&lt;/h2&gt;'</span> <span class="op">+</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;div class=&quot;form-container&quot;&gt;'</span> <span class="op">+</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;form id=&quot;einForm&quot; onsubmit=&quot;handleSubmit(event)&quot;&gt;'</span> <span class="op">+</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;label for=&quot;ein&quot;&gt;Enter EIN (e.g., 123456789):&lt;/label&gt;&lt;br&gt;'</span> <span class="op">+</span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;input type=&quot;text&quot; id=&quot;ein&quot; name=&quot;ein&quot; placeholder=&quot;Enter 9-digit EIN&quot; required&gt;&lt;br&gt;'</span> <span class="op">+</span></span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;input type=&quot;submit&quot; value=&quot;Fetch Data&quot;&gt;'</span> <span class="op">+</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/form&gt;'</span> <span class="op">+</span></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;div id=&quot;result&quot;&gt;&lt;/div&gt;'</span> <span class="op">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/div&gt;'</span> <span class="op">+</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;script&gt;'</span> <span class="op">+</span></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'function handleSubmit(event) {'</span> <span class="op">+</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  event.preventDefault();'</span> <span class="op">+</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  const ein = document.getElementById(&quot;ein&quot;).value;'</span> <span class="op">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  document.getElementById(&quot;result&quot;).innerHTML = &quot;Fetching data...&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  google.script.run'</span> <span class="op">+</span></span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    .withSuccessHandler(showResult)'</span> <span class="op">+</span></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    .withFailureHandler(showError)'</span> <span class="op">+</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    .fetchAndDisplayData(ein);'</span> <span class="op">+</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>    <span class="st">'}'</span> <span class="op">+</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>    <span class="st">'function showResult(result) {'</span> <span class="op">+</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  let html = &quot;&lt;p&gt;Data successfully loaded into sheet: &quot; + result.sheetName + &quot;&lt;/p&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  html += &quot;&lt;div class=</span><span class="ch">\\</span><span class="st">&quot;org-info</span><span class="ch">\\</span><span class="st">&quot;&gt;Organization: &quot; + result.orgName + &quot; (EIN: &quot; + result.ein + &quot;)&lt;/div&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  if (result.filings.length === 0) {'</span> <span class="op">+</span></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    html += &quot;&lt;p&gt;No filing data available for this organization.&lt;/p&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  } else {'</span> <span class="op">+</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    html += &quot;&lt;table&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    html += &quot;&lt;tr&gt;&lt;th&gt;Year&lt;/th&gt;&lt;th&gt;Total Revenue&lt;/th&gt;&lt;th&gt;Total Expenses&lt;/th&gt;&lt;th&gt;Total Assets&lt;/th&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>    <span class="st">'            &quot;&lt;th&gt;Total Liabilities&lt;/th&gt;&lt;th&gt;Net Assets&lt;/th&gt;&lt;th&gt;Contributions &amp; Grants&lt;/th&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="st">'            &quot;&lt;th&gt;Program Revenue&lt;/th&gt;&lt;th&gt;Investment Income&lt;/th&gt;&lt;/tr&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    result.filings.forEach(filing =&gt; {'</span> <span class="op">+</span></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="st">'      html += &quot;&lt;tr&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;&quot; + filing.year + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.totalRevenue.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.totalExpenses.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.totalAssets.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.totalLiabilities.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.netAssets.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.contributionsGrants.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.programRevenue.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;td&gt;$&quot; + filing.investmentIncome.toLocaleString(&quot;en-US&quot;, {minimumFractionDigits: 2, maximumFractionDigits: 2}) + &quot;&lt;/td&gt;&quot; +'</span> <span class="op">+</span></span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="st">'        &quot;&lt;/tr&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    });'</span> <span class="op">+</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="st">'    html += &quot;&lt;/table&gt;&quot;;'</span> <span class="op">+</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  }'</span> <span class="op">+</span></span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  document.getElementById(&quot;result&quot;).innerHTML = html;'</span> <span class="op">+</span></span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a>    <span class="st">'}'</span> <span class="op">+</span></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>    <span class="st">'function showError(error) {'</span> <span class="op">+</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>    <span class="st">'  document.getElementById(&quot;result&quot;).innerHTML = </span><span class="ch">\'</span><span class="st">&lt;span class=&quot;error&quot;&gt;Error: </span><span class="ch">\'</span><span class="st"> + error.message + </span><span class="ch">\'</span><span class="st">&lt;/span&gt;</span><span class="ch">\'</span><span class="st">;'</span> <span class="op">+</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>    <span class="st">'}'</span> <span class="op">+</span></span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/script&gt;'</span> <span class="op">+</span></span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/body&gt;'</span> <span class="op">+</span></span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="st">'&lt;/html&gt;'</span></span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>  ).setTitle(<span class="st">'Nonprofit Data Fetcher'</span>)<span class="op">;</span></span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Adds a custom menu to the spreadsheet when it opens</span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>function onOpen() {</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>  var ui <span class="op">=</span> SpreadsheetApp.getUi()<span class="op">;</span></span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>  ui.createMenu(<span class="st">'Nonprofit Tools'</span>)</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    .addItem(<span class="st">'Apply Working Sheet Format'</span>, <span class="st">'formatWorkingSheet'</span>)</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    .addItem(<span class="st">'Clear All Formatting'</span>, <span class="st">'clearAllFormatting'</span>)</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    .addItem(<span class="st">'Fetch Nonprofit Data by EIN'</span>, <span class="st">'showEinInputDialog'</span>)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>    .addItem(<span class="st">'Adjust Column Widths'</span>, <span class="st">'setOptimalColumnWidths'</span>)</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a>    .addToUi()<span class="op">;</span></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Shows a dialog box <span class="cf">for</span> entering an EIN (<span class="cf">for</span> sheet UI)</span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>function showEinInputDialog() {</span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a>  var ui <span class="op">=</span> SpreadsheetApp.getUi()<span class="op">;</span></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a>  var response <span class="op">=</span> ui.prompt(</span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Enter Nonprofit EIN'</span>,</span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>    <span class="st">'Please enter the EIN (Employer Identification Number) of the nonprofit:'</span>,</span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>    ui.ButtonSet.OK_CANCEL</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a>  )<span class="op">;</span></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (response.getSelectedButton() <span class="op">==</span> ui.Button.OK) {</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a>    var ein <span class="op">=</span> response.getResponseText().trim()<span class="op">;</span></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a>    ein <span class="op">=</span> ein.replace(<span class="op">/-/</span>g, <span class="st">''</span>)<span class="op">;</span></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (isValidEIN(ein)) {</span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a>      fetchAndDisplayData(ein)<span class="op">;</span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>      ui.alert(<span class="st">'Invalid EIN Format'</span>, <span class="st">'Please enter a valid 9-digit EIN.'</span>, ui.ButtonSet.OK)<span class="op">;</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Validates <span class="cf">if</span> the string <span class="kw">is</span> a proper EIN (<span class="dv">9</span> digits)</span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>function isValidEIN(ein) {</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>  <span class="cf">return</span> <span class="op">/^</span>\d{<span class="dv">9</span>}$<span class="op">/</span>.test(ein)<span class="op">;</span></span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Fetches nonprofit data <span class="im">from</span> ProPublica API <span class="kw">and</span> displays it <span class="kw">in</span> a new sheet</span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>function fetchAndDisplayData(ein) {</span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  var spreadsheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet()<span class="op">;</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  ein <span class="op">=</span> ein.replace(<span class="op">/-/</span>g, <span class="st">''</span>)<span class="op">;</span></span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>isValidEIN(ein)) {</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    throw new Error(<span class="st">'Invalid EIN Format. Please enter a valid 9-digit EIN.'</span>)<span class="op">;</span></span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>    var options <span class="op">=</span> {</span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>      <span class="st">'headers'</span>: {</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>        <span class="st">'User-Agent'</span>: <span class="st">'NonprofitDataFetcher/1.0 (Google Apps Script)'</span></span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>    var response <span class="op">=</span> UrlFetchApp.fetch(Config.API_BASE_URL <span class="op">+</span> ein <span class="op">+</span> <span class="st">&quot;.json&quot;</span>, options)<span class="op">;</span></span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a>    Logger.log(<span class="st">'API Response Status: '</span> <span class="op">+</span> response.getResponseCode())<span class="op">;</span></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>    var data <span class="op">=</span> JSON.parse(response.getContentText())<span class="op">;</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    var orgName <span class="op">=</span> data.organization.name<span class="op">;</span></span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    var safeOrgName <span class="op">=</span> orgName.replace(<span class="op">/</span>[<span class="op">^</span>a<span class="op">-</span>zA<span class="op">-</span>Z0<span class="op">-</span><span class="dv">9</span>\s<span class="op">-</span>_]<span class="op">/</span>g, <span class="st">''</span>)<span class="op">;</span></span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    var sheetNameBase <span class="op">=</span> safeOrgName.substring(<span class="dv">0</span>, <span class="dv">80</span>) <span class="op">+</span> <span class="st">&quot; (&quot;</span> <span class="op">+</span> ein <span class="op">+</span> <span class="st">&quot;)&quot;</span><span class="op">;</span></span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>    var sheetName <span class="op">=</span> sheetNameBase.substring(<span class="dv">0</span>, <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a>    var counter <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> (spreadsheet.getSheetByName(sheetName)) {</span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a>      sheetName <span class="op">=</span> sheetNameBase.substring(<span class="dv">0</span>, <span class="dv">95</span>) <span class="op">+</span> <span class="st">&quot;_&quot;</span> <span class="op">+</span> counter<span class="op">;</span></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a>      counter<span class="op">++;</span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a>    var sheet <span class="op">=</span> spreadsheet.insertSheet(sheetName)<span class="op">;</span></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a>    sheet.clear()<span class="op">;</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">9</span>).merge()<span class="op">;</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>).setValue(<span class="st">&quot;NONPROFIT DATA: &quot;</span> <span class="op">+</span> orgName <span class="op">+</span> <span class="st">&quot; (EIN: &quot;</span> <span class="op">+</span> ein <span class="op">+</span> <span class="st">&quot;)&quot;</span>)<span class="op">;</span></span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>).setFontSize(<span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>).setFontWeight(<span class="st">&quot;bold&quot;</span>)<span class="op">;</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>).setHorizontalAlignment(<span class="st">&quot;center&quot;</span>)<span class="op">;</span></span>
<span id="cb1-174"><a href="#cb1-174" aria-hidden="true" tabindex="-1"></a>    sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>).setBackground(<span class="st">&quot;#4285F4&quot;</span>)<span class="op">;</span></span>
<span id="cb1-175"><a href="#cb1-175" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-176"><a href="#cb1-176" aria-hidden="true" tabindex="-1"></a>    var headers <span class="op">=</span> [</span>
<span id="cb1-177"><a href="#cb1-177" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Total Revenue&quot;</span>, <span class="st">&quot;Total Expenses&quot;</span>, <span class="st">&quot;Total Assets&quot;</span>,</span>
<span id="cb1-178"><a href="#cb1-178" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Total Liabilities&quot;</span>, <span class="st">&quot;Net Assets&quot;</span>, <span class="st">&quot;Contributions &amp; Grants&quot;</span>,</span>
<span id="cb1-179"><a href="#cb1-179" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Program Revenue&quot;</span>, <span class="st">&quot;Investment Income&quot;</span></span>
<span id="cb1-180"><a href="#cb1-180" aria-hidden="true" tabindex="-1"></a>    ]<span class="op">;</span></span>
<span id="cb1-181"><a href="#cb1-181" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-182"><a href="#cb1-182" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> headers.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-183"><a href="#cb1-183" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">2</span>, i <span class="op">+</span> <span class="dv">1</span>).setValue(headers[i])<span class="op">;</span></span>
<span id="cb1-184"><a href="#cb1-184" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">2</span>, i <span class="op">+</span> <span class="dv">1</span>).setFontWeight(<span class="st">&quot;bold&quot;</span>)<span class="op">;</span></span>
<span id="cb1-185"><a href="#cb1-185" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">2</span>, i <span class="op">+</span> <span class="dv">1</span>).setBackground(<span class="st">&quot;#D9EAD3&quot;</span>)<span class="op">;</span></span>
<span id="cb1-186"><a href="#cb1-186" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-187"><a href="#cb1-187" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-188"><a href="#cb1-188" aria-hidden="true" tabindex="-1"></a>    var filings <span class="op">=</span> data.filings_with_data<span class="op">;</span></span>
<span id="cb1-189"><a href="#cb1-189" aria-hidden="true" tabindex="-1"></a>    var filingData <span class="op">=</span> []<span class="op">;</span></span>
<span id="cb1-190"><a href="#cb1-190" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (filings <span class="op">&amp;&amp;</span> filings.length <span class="op">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb1-191"><a href="#cb1-191" aria-hidden="true" tabindex="-1"></a>      filings.sort(function(a, b) { <span class="cf">return</span> b.tax_prd <span class="op">-</span> a.tax_prd<span class="op">;</span> })<span class="op">;</span></span>
<span id="cb1-192"><a href="#cb1-192" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-193"><a href="#cb1-193" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> filings.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-194"><a href="#cb1-194" aria-hidden="true" tabindex="-1"></a>        var filing <span class="op">=</span> filings[i]<span class="op">;</span></span>
<span id="cb1-195"><a href="#cb1-195" aria-hidden="true" tabindex="-1"></a>        var row <span class="op">=</span> i <span class="op">+</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb1-196"><a href="#cb1-196" aria-hidden="true" tabindex="-1"></a>        var yearStr <span class="op">=</span> String(filing.tax_prd_yr)<span class="op">;</span></span>
<span id="cb1-197"><a href="#cb1-197" aria-hidden="true" tabindex="-1"></a>        var values <span class="op">=</span> [</span>
<span id="cb1-198"><a href="#cb1-198" aria-hidden="true" tabindex="-1"></a>          yearStr, filing.totrevenue <span class="op">||</span> <span class="dv">0</span>, filing.totfuncexpns <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-199"><a href="#cb1-199" aria-hidden="true" tabindex="-1"></a>          filing.totassetsend <span class="op">||</span> <span class="dv">0</span>, filing.totliabend <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-200"><a href="#cb1-200" aria-hidden="true" tabindex="-1"></a>          (filing.totnetassetend <span class="op">||</span> <span class="dv">0</span>), filing.totcntrbgfts <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-201"><a href="#cb1-201" aria-hidden="true" tabindex="-1"></a>          filing.totprgmrevnue <span class="op">||</span> <span class="dv">0</span>, filing.invstmntinc <span class="op">||</span> <span class="dv">0</span></span>
<span id="cb1-202"><a href="#cb1-202" aria-hidden="true" tabindex="-1"></a>        ]<span class="op">;</span></span>
<span id="cb1-203"><a href="#cb1-203" aria-hidden="true" tabindex="-1"></a>        sheet.getRange(row, <span class="dv">1</span>, <span class="dv">1</span>, values.length).setValues([values])<span class="op">;</span></span>
<span id="cb1-204"><a href="#cb1-204" aria-hidden="true" tabindex="-1"></a>        filingData.push({</span>
<span id="cb1-205"><a href="#cb1-205" aria-hidden="true" tabindex="-1"></a>          year: yearStr,</span>
<span id="cb1-206"><a href="#cb1-206" aria-hidden="true" tabindex="-1"></a>          totalRevenue: filing.totrevenue <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-207"><a href="#cb1-207" aria-hidden="true" tabindex="-1"></a>          totalExpenses: filing.totfuncexpns <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-208"><a href="#cb1-208" aria-hidden="true" tabindex="-1"></a>          totalAssets: filing.totassetsend <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-209"><a href="#cb1-209" aria-hidden="true" tabindex="-1"></a>          totalLiabilities: filing.totliabend <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-210"><a href="#cb1-210" aria-hidden="true" tabindex="-1"></a>          netAssets: filing.totnetassetend <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-211"><a href="#cb1-211" aria-hidden="true" tabindex="-1"></a>          contributionsGrants: filing.totcntrbgfts <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-212"><a href="#cb1-212" aria-hidden="true" tabindex="-1"></a>          programRevenue: filing.totprgmrevnue <span class="op">||</span> <span class="dv">0</span>,</span>
<span id="cb1-213"><a href="#cb1-213" aria-hidden="true" tabindex="-1"></a>          investmentIncome: filing.invstmntinc <span class="op">||</span> <span class="dv">0</span></span>
<span id="cb1-214"><a href="#cb1-214" aria-hidden="true" tabindex="-1"></a>        })<span class="op">;</span></span>
<span id="cb1-215"><a href="#cb1-215" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb1-216"><a href="#cb1-216" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb1-217"><a href="#cb1-217" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">3</span>, <span class="dv">2</span>, filings.length, <span class="dv">8</span>).setNumberFormat(<span class="st">&quot;$#,##0.00&quot;</span>)<span class="op">;</span></span>
<span id="cb1-218"><a href="#cb1-218" aria-hidden="true" tabindex="-1"></a>      setOptimalColumnWidths(sheet)<span class="op">;</span></span>
<span id="cb1-219"><a href="#cb1-219" aria-hidden="true" tabindex="-1"></a>      sheet.setFrozenRows(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-220"><a href="#cb1-220" aria-hidden="true" tabindex="-1"></a>      applyAlternatingRowColors(sheet, <span class="dv">3</span>, filings.length)<span class="op">;</span></span>
<span id="cb1-221"><a href="#cb1-221" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, filings.length <span class="op">+</span> <span class="dv">2</span>, <span class="dv">9</span>).setBorder(</span>
<span id="cb1-222"><a href="#cb1-222" aria-hidden="true" tabindex="-1"></a>        true, true, true, true, true, true, <span class="st">&quot;black&quot;</span>, SpreadsheetApp.BorderStyle.SOLID</span>
<span id="cb1-223"><a href="#cb1-223" aria-hidden="true" tabindex="-1"></a>      )<span class="op">;</span></span>
<span id="cb1-224"><a href="#cb1-224" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb1-225"><a href="#cb1-225" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">3</span>, <span class="dv">1</span>).setValue(<span class="st">&quot;No filing data available for this organization.&quot;</span>)<span class="op">;</span></span>
<span id="cb1-226"><a href="#cb1-226" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-227"><a href="#cb1-227" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-228"><a href="#cb1-228" aria-hidden="true" tabindex="-1"></a>    spreadsheet.setActiveSheet(sheet)<span class="op">;</span></span>
<span id="cb1-229"><a href="#cb1-229" aria-hidden="true" tabindex="-1"></a>    SpreadsheetApp.flush()<span class="op">;</span></span>
<span id="cb1-230"><a href="#cb1-230" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-231"><a href="#cb1-231" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> {</span>
<span id="cb1-232"><a href="#cb1-232" aria-hidden="true" tabindex="-1"></a>      sheetName: sheetName,</span>
<span id="cb1-233"><a href="#cb1-233" aria-hidden="true" tabindex="-1"></a>      orgName: orgName,</span>
<span id="cb1-234"><a href="#cb1-234" aria-hidden="true" tabindex="-1"></a>      ein: ein,</span>
<span id="cb1-235"><a href="#cb1-235" aria-hidden="true" tabindex="-1"></a>      filings: filingData</span>
<span id="cb1-236"><a href="#cb1-236" aria-hidden="true" tabindex="-1"></a>    }<span class="op">;</span></span>
<span id="cb1-237"><a href="#cb1-237" aria-hidden="true" tabindex="-1"></a>  } catch (error) {</span>
<span id="cb1-238"><a href="#cb1-238" aria-hidden="true" tabindex="-1"></a>    Logger.log(<span class="st">'Error: '</span> <span class="op">+</span> error.message)<span class="op">;</span></span>
<span id="cb1-239"><a href="#cb1-239" aria-hidden="true" tabindex="-1"></a>    throw new Error(<span class="st">&quot;Failed to fetch data: &quot;</span> <span class="op">+</span> error.message)<span class="op">;</span></span>
<span id="cb1-240"><a href="#cb1-240" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-241"><a href="#cb1-241" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-242"><a href="#cb1-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-243"><a href="#cb1-243" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-244"><a href="#cb1-244" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Sets optimal column widths based on content</span>
<span id="cb1-245"><a href="#cb1-245" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-246"><a href="#cb1-246" aria-hidden="true" tabindex="-1"></a>function setOptimalColumnWidths(sheet) {</span>
<span id="cb1-247"><a href="#cb1-247" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>sheet) {</span>
<span id="cb1-248"><a href="#cb1-248" aria-hidden="true" tabindex="-1"></a>    sheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()<span class="op">;</span></span>
<span id="cb1-249"><a href="#cb1-249" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-250"><a href="#cb1-250" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-251"><a href="#cb1-251" aria-hidden="true" tabindex="-1"></a>  var columnWidths <span class="op">=</span> [</span>
<span id="cb1-252"><a href="#cb1-252" aria-hidden="true" tabindex="-1"></a>    <span class="dv">60</span>, <span class="dv">120</span>, <span class="dv">120</span>, <span class="dv">120</span>, <span class="dv">120</span>, <span class="dv">120</span>, <span class="dv">150</span>, <span class="dv">120</span>, <span class="dv">120</span></span>
<span id="cb1-253"><a href="#cb1-253" aria-hidden="true" tabindex="-1"></a>  ]<span class="op">;</span></span>
<span id="cb1-254"><a href="#cb1-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-255"><a href="#cb1-255" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> columnWidths.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-256"><a href="#cb1-256" aria-hidden="true" tabindex="-1"></a>    sheet.setColumnWidth(i <span class="op">+</span> <span class="dv">1</span>, columnWidths[i])<span class="op">;</span></span>
<span id="cb1-257"><a href="#cb1-257" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-258"><a href="#cb1-258" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-259"><a href="#cb1-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-260"><a href="#cb1-260" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-261"><a href="#cb1-261" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Clears <span class="bu">all</span> data <span class="im">from</span> the sheet <span class="cf">except</span> <span class="cf">for</span> <span class="bu">any</span> formatting</span>
<span id="cb1-262"><a href="#cb1-262" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-263"><a href="#cb1-263" aria-hidden="true" tabindex="-1"></a>function clearSheetData() {</span>
<span id="cb1-264"><a href="#cb1-264" aria-hidden="true" tabindex="-1"></a>  var sheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()<span class="op">;</span></span>
<span id="cb1-265"><a href="#cb1-265" aria-hidden="true" tabindex="-1"></a>  var lastRow <span class="op">=</span> Math.<span class="bu">max</span>(sheet.getLastRow(), <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb1-266"><a href="#cb1-266" aria-hidden="true" tabindex="-1"></a>  var lastCol <span class="op">=</span> Math.<span class="bu">max</span>(sheet.getLastColumn(), <span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb1-267"><a href="#cb1-267" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-268"><a href="#cb1-268" aria-hidden="true" tabindex="-1"></a>  sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, lastRow, lastCol).clearContent()<span class="op">;</span></span>
<span id="cb1-269"><a href="#cb1-269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-270"><a href="#cb1-270" aria-hidden="true" tabindex="-1"></a>  <span class="cf">try</span> {</span>
<span id="cb1-271"><a href="#cb1-271" aria-hidden="true" tabindex="-1"></a>    var headerRange <span class="op">=</span> sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, lastCol)<span class="op">;</span></span>
<span id="cb1-272"><a href="#cb1-272" aria-hidden="true" tabindex="-1"></a>    headerRange.breakApart()<span class="op">;</span></span>
<span id="cb1-273"><a href="#cb1-273" aria-hidden="true" tabindex="-1"></a>  } catch (e) {</span>
<span id="cb1-274"><a href="#cb1-274" aria-hidden="true" tabindex="-1"></a>    Logger.log(<span class="st">&quot;Note: Could not unmerge cells: &quot;</span> <span class="op">+</span> e.message)<span class="op">;</span></span>
<span id="cb1-275"><a href="#cb1-275" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-276"><a href="#cb1-276" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-277"><a href="#cb1-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-278"><a href="#cb1-278" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-279"><a href="#cb1-279" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Apply alternating row colors to the data rows</span>
<span id="cb1-280"><a href="#cb1-280" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-281"><a href="#cb1-281" aria-hidden="true" tabindex="-1"></a>function applyAlternatingRowColors(sheet, startRow, numRows) {</span>
<span id="cb1-282"><a href="#cb1-282" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="op">!</span>sheet) {</span>
<span id="cb1-283"><a href="#cb1-283" aria-hidden="true" tabindex="-1"></a>    sheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()<span class="op">;</span></span>
<span id="cb1-284"><a href="#cb1-284" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-285"><a href="#cb1-285" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-286"><a href="#cb1-286" aria-hidden="true" tabindex="-1"></a>  var currentBandings <span class="op">=</span> sheet.getBandings()<span class="op">;</span></span>
<span id="cb1-287"><a href="#cb1-287" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> currentBandings.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-288"><a href="#cb1-288" aria-hidden="true" tabindex="-1"></a>    currentBandings[i].remove()<span class="op">;</span></span>
<span id="cb1-289"><a href="#cb1-289" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-290"><a href="#cb1-290" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-291"><a href="#cb1-291" aria-hidden="true" tabindex="-1"></a>  var dataRange <span class="op">=</span> sheet.getRange(startRow, <span class="dv">1</span>, numRows, <span class="dv">9</span>)<span class="op">;</span></span>
<span id="cb1-292"><a href="#cb1-292" aria-hidden="true" tabindex="-1"></a>  var banding <span class="op">=</span> dataRange.applyRowBanding()<span class="op">;</span></span>
<span id="cb1-293"><a href="#cb1-293" aria-hidden="true" tabindex="-1"></a>  banding.setHeaderRowColor(null)<span class="op">;</span></span>
<span id="cb1-294"><a href="#cb1-294" aria-hidden="true" tabindex="-1"></a>  banding.setFirstRowColor(<span class="st">&quot;#F3F3F3&quot;</span>)<span class="op">;</span></span>
<span id="cb1-295"><a href="#cb1-295" aria-hidden="true" tabindex="-1"></a>  banding.setSecondRowColor(<span class="st">&quot;#E6F2FF&quot;</span>)<span class="op">;</span></span>
<span id="cb1-296"><a href="#cb1-296" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-297"><a href="#cb1-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-298"><a href="#cb1-298" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-299"><a href="#cb1-299" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Formats the working sheet</span>
<span id="cb1-300"><a href="#cb1-300" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-301"><a href="#cb1-301" aria-hidden="true" tabindex="-1"></a>function formatWorkingSheet() {</span>
<span id="cb1-302"><a href="#cb1-302" aria-hidden="true" tabindex="-1"></a>  var sheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()<span class="op">;</span></span>
<span id="cb1-303"><a href="#cb1-303" aria-hidden="true" tabindex="-1"></a>  var lastColumn <span class="op">=</span> Math.<span class="bu">max</span>(<span class="dv">1</span>, sheet.getLastColumn())<span class="op">;</span></span>
<span id="cb1-304"><a href="#cb1-304" aria-hidden="true" tabindex="-1"></a>  var lastRow <span class="op">=</span> Math.<span class="bu">max</span>(<span class="dv">1</span>, sheet.getLastRow())<span class="op">;</span></span>
<span id="cb1-305"><a href="#cb1-305" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-306"><a href="#cb1-306" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastColumn <span class="op">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb1-307"><a href="#cb1-307" aria-hidden="true" tabindex="-1"></a>    var headerRange <span class="op">=</span> sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, lastColumn)<span class="op">;</span></span>
<span id="cb1-308"><a href="#cb1-308" aria-hidden="true" tabindex="-1"></a>    headerRange.setHorizontalAlignment(<span class="st">&quot;center&quot;</span>)<span class="op">;</span></span>
<span id="cb1-309"><a href="#cb1-309" aria-hidden="true" tabindex="-1"></a>    headerRange.merge()<span class="op">;</span></span>
<span id="cb1-310"><a href="#cb1-310" aria-hidden="true" tabindex="-1"></a>    headerRange.setValue(<span class="st">&quot;WORKING SHEET&quot;</span>)<span class="op">;</span></span>
<span id="cb1-311"><a href="#cb1-311" aria-hidden="true" tabindex="-1"></a>    headerRange.setFontSize(<span class="dv">14</span>)<span class="op">;</span></span>
<span id="cb1-312"><a href="#cb1-312" aria-hidden="true" tabindex="-1"></a>    headerRange.setFontWeight(<span class="st">&quot;bold&quot;</span>)<span class="op">;</span></span>
<span id="cb1-313"><a href="#cb1-313" aria-hidden="true" tabindex="-1"></a>    headerRange.setHorizontalAlignment(<span class="st">&quot;center&quot;</span>)<span class="op">;</span></span>
<span id="cb1-314"><a href="#cb1-314" aria-hidden="true" tabindex="-1"></a>    headerRange.setVerticalAlignment(<span class="st">&quot;middle&quot;</span>)<span class="op">;</span></span>
<span id="cb1-315"><a href="#cb1-315" aria-hidden="true" tabindex="-1"></a>    headerRange.setBackground(<span class="st">&quot;#4285F4&quot;</span>)<span class="op">;</span></span>
<span id="cb1-316"><a href="#cb1-316" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-317"><a href="#cb1-317" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-318"><a href="#cb1-318" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastColumn <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> lastRow <span class="op">&gt;=</span> <span class="dv">2</span>) {</span>
<span id="cb1-319"><a href="#cb1-319" aria-hidden="true" tabindex="-1"></a>    var firstDataRow <span class="op">=</span> sheet.getRange(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, lastColumn)<span class="op">;</span></span>
<span id="cb1-320"><a href="#cb1-320" aria-hidden="true" tabindex="-1"></a>    firstDataRow.setFontWeight(<span class="st">&quot;bold&quot;</span>)<span class="op">;</span></span>
<span id="cb1-321"><a href="#cb1-321" aria-hidden="true" tabindex="-1"></a>    firstDataRow.setHorizontalAlignment(<span class="st">&quot;left&quot;</span>)<span class="op">;</span></span>
<span id="cb1-322"><a href="#cb1-322" aria-hidden="true" tabindex="-1"></a>    firstDataRow.setBackground(<span class="st">&quot;#D9EAD3&quot;</span>)<span class="op">;</span></span>
<span id="cb1-323"><a href="#cb1-323" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-324"><a href="#cb1-324" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-325"><a href="#cb1-325" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastColumn <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> lastRow <span class="op">&gt;=</span> <span class="dv">3</span>) {</span>
<span id="cb1-326"><a href="#cb1-326" aria-hidden="true" tabindex="-1"></a>    var dataRange <span class="op">=</span> sheet.getRange(<span class="dv">3</span>, <span class="dv">1</span>, Math.<span class="bu">max</span>(<span class="dv">1</span>, lastRow <span class="op">-</span> <span class="dv">2</span>), lastColumn)<span class="op">;</span></span>
<span id="cb1-327"><a href="#cb1-327" aria-hidden="true" tabindex="-1"></a>    var currentBandings <span class="op">=</span> sheet.getBandings()<span class="op">;</span></span>
<span id="cb1-328"><a href="#cb1-328" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> currentBandings.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-329"><a href="#cb1-329" aria-hidden="true" tabindex="-1"></a>      currentBandings[i].remove()<span class="op">;</span></span>
<span id="cb1-330"><a href="#cb1-330" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-331"><a href="#cb1-331" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-332"><a href="#cb1-332" aria-hidden="true" tabindex="-1"></a>    var banding <span class="op">=</span> dataRange.applyRowBanding()<span class="op">;</span></span>
<span id="cb1-333"><a href="#cb1-333" aria-hidden="true" tabindex="-1"></a>    banding.setHeaderRowColor(null)<span class="op">;</span></span>
<span id="cb1-334"><a href="#cb1-334" aria-hidden="true" tabindex="-1"></a>    banding.setFirstRowColor(<span class="st">&quot;#F3F3F3&quot;</span>)<span class="op">;</span></span>
<span id="cb1-335"><a href="#cb1-335" aria-hidden="true" tabindex="-1"></a>    banding.setSecondRowColor(<span class="st">&quot;#E6F2FF&quot;</span>)<span class="op">;</span></span>
<span id="cb1-336"><a href="#cb1-336" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-337"><a href="#cb1-337" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-338"><a href="#cb1-338" aria-hidden="true" tabindex="-1"></a>  sheet.setFrozenRows(<span class="dv">2</span>)<span class="op">;</span></span>
<span id="cb1-339"><a href="#cb1-339" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-340"><a href="#cb1-340" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastColumn <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> lastRow <span class="op">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb1-341"><a href="#cb1-341" aria-hidden="true" tabindex="-1"></a>    var fullRange <span class="op">=</span> sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, lastRow, lastColumn)<span class="op">;</span></span>
<span id="cb1-342"><a href="#cb1-342" aria-hidden="true" tabindex="-1"></a>    fullRange.setBorder(true, true, true, true, true, true, <span class="st">&quot;black&quot;</span>, SpreadsheetApp.BorderStyle.SOLID)<span class="op">;</span></span>
<span id="cb1-343"><a href="#cb1-343" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-344"><a href="#cb1-344" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-345"><a href="#cb1-345" aria-hidden="true" tabindex="-1"></a>  setOptimalColumnWidths(sheet)<span class="op">;</span></span>
<span id="cb1-346"><a href="#cb1-346" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-347"><a href="#cb1-347" aria-hidden="true" tabindex="-1"></a>  SpreadsheetApp.getActive().toast(<span class="st">&quot;Working sheet formatting applied successfully!&quot;</span>, <span class="st">&quot;Format Complete&quot;</span>, <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb1-348"><a href="#cb1-348" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-349"><a href="#cb1-349" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-350"><a href="#cb1-350" aria-hidden="true" tabindex="-1"></a><span class="op">/**</span></span>
<span id="cb1-351"><a href="#cb1-351" aria-hidden="true" tabindex="-1"></a> <span class="op">*</span> Clears <span class="bu">all</span> formatting <span class="im">from</span> the sheet <span class="cf">while</span> preserving data</span>
<span id="cb1-352"><a href="#cb1-352" aria-hidden="true" tabindex="-1"></a> <span class="op">*/</span></span>
<span id="cb1-353"><a href="#cb1-353" aria-hidden="true" tabindex="-1"></a>function clearAllFormatting() {</span>
<span id="cb1-354"><a href="#cb1-354" aria-hidden="true" tabindex="-1"></a>  var sheet <span class="op">=</span> SpreadsheetApp.getActiveSpreadsheet().getActiveSheet()<span class="op">;</span></span>
<span id="cb1-355"><a href="#cb1-355" aria-hidden="true" tabindex="-1"></a>  var lastColumn <span class="op">=</span> Math.<span class="bu">max</span>(<span class="dv">1</span>, sheet.getLastColumn())<span class="op">;</span></span>
<span id="cb1-356"><a href="#cb1-356" aria-hidden="true" tabindex="-1"></a>  var lastRow <span class="op">=</span> Math.<span class="bu">max</span>(<span class="dv">1</span>, sheet.getLastRow())<span class="op">;</span></span>
<span id="cb1-357"><a href="#cb1-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-358"><a href="#cb1-358" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (lastColumn <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">&amp;&amp;</span> lastRow <span class="op">&gt;=</span> <span class="dv">1</span>) {</span>
<span id="cb1-359"><a href="#cb1-359" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> {</span>
<span id="cb1-360"><a href="#cb1-360" aria-hidden="true" tabindex="-1"></a>      sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, lastRow, lastColumn).breakApart()<span class="op">;</span></span>
<span id="cb1-361"><a href="#cb1-361" aria-hidden="true" tabindex="-1"></a>    } catch (e) {</span>
<span id="cb1-362"><a href="#cb1-362" aria-hidden="true" tabindex="-1"></a>      Logger.log(<span class="st">&quot;Note: Could not unmerge cells: &quot;</span> <span class="op">+</span> e.message)<span class="op">;</span></span>
<span id="cb1-363"><a href="#cb1-363" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-364"><a href="#cb1-364" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-365"><a href="#cb1-365" aria-hidden="true" tabindex="-1"></a>    var currentBandings <span class="op">=</span> sheet.getBandings()<span class="op">;</span></span>
<span id="cb1-366"><a href="#cb1-366" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> currentBandings.length<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-367"><a href="#cb1-367" aria-hidden="true" tabindex="-1"></a>      currentBandings[i].remove()<span class="op">;</span></span>
<span id="cb1-368"><a href="#cb1-368" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-369"><a href="#cb1-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-370"><a href="#cb1-370" aria-hidden="true" tabindex="-1"></a>    var fullRange <span class="op">=</span> sheet.getRange(<span class="dv">1</span>, <span class="dv">1</span>, lastRow, lastColumn)<span class="op">;</span></span>
<span id="cb1-371"><a href="#cb1-371" aria-hidden="true" tabindex="-1"></a>    fullRange.clearFormat()<span class="op">;</span></span>
<span id="cb1-372"><a href="#cb1-372" aria-hidden="true" tabindex="-1"></a>    fullRange.clearNote()<span class="op">;</span></span>
<span id="cb1-373"><a href="#cb1-373" aria-hidden="true" tabindex="-1"></a>    fullRange.setFontFamily(null)<span class="op">;</span></span>
<span id="cb1-374"><a href="#cb1-374" aria-hidden="true" tabindex="-1"></a>    fullRange.setFontSize(<span class="dv">10</span>)<span class="op">;</span></span>
<span id="cb1-375"><a href="#cb1-375" aria-hidden="true" tabindex="-1"></a>    fullRange.setFontWeight(<span class="st">&quot;normal&quot;</span>)<span class="op">;</span></span>
<span id="cb1-376"><a href="#cb1-376" aria-hidden="true" tabindex="-1"></a>    fullRange.setFontStyle(<span class="st">&quot;normal&quot;</span>)<span class="op">;</span></span>
<span id="cb1-377"><a href="#cb1-377" aria-hidden="true" tabindex="-1"></a>    fullRange.setHorizontalAlignment(<span class="st">&quot;left&quot;</span>)<span class="op">;</span></span>
<span id="cb1-378"><a href="#cb1-378" aria-hidden="true" tabindex="-1"></a>    fullRange.setVerticalAlignment(<span class="st">&quot;bottom&quot;</span>)<span class="op">;</span></span>
<span id="cb1-379"><a href="#cb1-379" aria-hidden="true" tabindex="-1"></a>    fullRange.setBackground(null)<span class="op">;</span></span>
<span id="cb1-380"><a href="#cb1-380" aria-hidden="true" tabindex="-1"></a>    fullRange.setBorder(false, false, false, false, false, false)<span class="op">;</span></span>
<span id="cb1-381"><a href="#cb1-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-382"><a href="#cb1-382" aria-hidden="true" tabindex="-1"></a>    sheet.clearConditionalFormatRules()<span class="op">;</span></span>
<span id="cb1-383"><a href="#cb1-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-384"><a href="#cb1-384" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (var i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;=</span> lastColumn<span class="op">;</span> i<span class="op">++</span>) {</span>
<span id="cb1-385"><a href="#cb1-385" aria-hidden="true" tabindex="-1"></a>      sheet.setColumnWidth(i, <span class="dv">100</span>)<span class="op">;</span></span>
<span id="cb1-386"><a href="#cb1-386" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb1-387"><a href="#cb1-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-388"><a href="#cb1-388" aria-hidden="true" tabindex="-1"></a>    sheet.setFrozenRows(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-389"><a href="#cb1-389" aria-hidden="true" tabindex="-1"></a>    sheet.setFrozenColumns(<span class="dv">0</span>)<span class="op">;</span></span>
<span id="cb1-390"><a href="#cb1-390" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb1-391"><a href="#cb1-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-392"><a href="#cb1-392" aria-hidden="true" tabindex="-1"></a>  SpreadsheetApp.getActive().toast(<span class="st">&quot;All formatting has been cleared!&quot;</span>, <span class="st">&quot;Clear Complete&quot;</span>, <span class="dv">5</span>)<span class="op">;</span></span>
<span id="cb1-393"><a href="#cb1-393" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Code 2. Configuration for deploying the Google Apps Script as a web app, including HTML interface and server-side settings.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;timeZone&quot;</span>: <span class="st">&quot;America/New_York&quot;</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dependencies&quot;</span>: {},</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;exceptionLogging&quot;</span>: <span class="st">&quot;STACKDRIVER&quot;</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;oauthScopes&quot;</span>: [</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;https://www.googleapis.com/auth/spreadsheets&quot;</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;https://www.googleapis.com/auth/script.external_request&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  ],</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;webapp&quot;</span>: {</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;executeAs&quot;</span>: <span class="st">&quot;USER_DEPLOYING&quot;</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;access&quot;</span>: <span class="st">&quot;ANYONE&quot;</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h1 id="results">Results</h1>
<p><img src="../images/web_app_view.png" alt="Web App Interface" /></p>
<p><strong>Figure 1.</strong> Screenshot of the web app interface displaying nonprofit financial data retrieved from the ProPublica API for a sample organization, including a table of filing years and metrics.</p>
<p><img src="../images/workbook_view.png" alt="Google Sheet Output" /></p>
<p><strong>Figure 2.</strong> Screenshot of the Google Workbook showing a dynamically created sheet with nonprofit financial data, formatted with headers and alternating row colors.</p>
<h1 id="discussion">Discussion</h1>
<p>The implementation successfully demonstrates how Google Sheets with Google Apps Script overcomes a major limitation of Excel’s free online version: the inability to connect directly to external APIs. Our solution provides seamless API integration with an intuitive interface, enabling users to retrieve and analyze external data without premium spreadsheet subscriptions.</p>
<p>The web app interface shown in Figure 1 represents a significant advantage of this approach, allowing anyone to access the data retrieval functionality without a Google account. The interface provides a simple form for entering an EIN, delivering results in a clearly formatted table with financial metrics across multiple years. This external accessibility extends the utility of spreadsheet-based tools beyond organizational boundaries, making it valuable for public-facing applications where data transparency is important.</p>
<p>The Google Workbook output in Figure 2 illustrates how the retrieved data seamlessly integrates into the spreadsheet environment. Each organization’s data populates a new sheet named with the organization’s details, applying consistent formatting with bold headers, frozen rows, and currency formatting. This automatic sheet creation and formatting eliminates manual data entry and presentation tasks, streamlining the workflow for analyzing multiple organizations.</p>
<p>From a technical perspective, several features enhance the system’s robustness and usability. The namespaced configuration approach prevents variable conflicts, a common issue in larger script projects. The implementation of a User-Agent header in API requests ensures compatibility with external servers that might otherwise reject automated queries. Comprehensive error handling provides clear feedback when issues arise, improving the user experience for both technical and non-technical users.</p>
<p>One key benefit of this Google-based approach is the elimination of licensing costs that would typically accompany similar functionality in commercial spreadsheet applications. Enterprise versions of Excel that support API connectivity require significant investment, while our implementation leverages entirely free tools. This cost advantage makes advanced data capabilities accessible to individuals, small organizations, and educational settings where budget constraints might otherwise limit technological solutions.</p>
<p>The methodology also offers flexibility for adaptation to other data sources. While I demonstrated connectivity with the ProPublica API, the same approach works with virtually any REST API that returns structured data. Users could modify this template to connect to weather services, stock market data, social media metrics, or internal organizational APIs with minimal changes to the core functionality.</p>
<p>Limitations of this approach include dependence on Google’s ecosystem and potential API rate limits imposed by data providers. Future enhancements could include adding export capabilities from the web app, implementing caching to reduce API calls, and creating visualization options directly within the interface. Despite these considerations, the implementation successfully demonstrates how free Google tools can match or exceed capabilities found in premium spreadsheet applications.</p>
<h1 class="unnumbered" id="references">References</h1>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-ProPublica2025" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">ProPublica. Nonprofit Explorer API Documentation, 2025. <a href="https://projects.propublica.org/nonprofits/api">https://projects.propublica.org/nonprofits/api</a>.</div>
</div>
</div>
    </main>

<footer>
    <div class="footer-content">
        <div class="footer-text">
            Site generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>, authored by <a href="https://noprofits.org">No Profits</a> 
        </br>Select content assisted by <a href="https://www.anthropic.com/claude">Claude</a> - <a href="../colophon.html">Colophon</a>
        </div>
        <div class="print-pdf-button">
            <button onclick="window.print();" class="print-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="print-icon">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print / Save as PDF
            </button>
        </div>
    </div>
</footer>
</body>

</html>