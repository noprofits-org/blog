<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="NoProfits.org - Blogs about science, nonprofits, and other fun stuff.">
    <title>NoProfits Blog</title>
    <link rel="stylesheet" href="../css/default.css" />
    <script defer src="../js/mathjax-config.js"></script>
    <script defer src="../js/code-copy.js"></script>
    <script defer id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
    <link rel="icon" type="image/svg+xml" href="../images/favicon.svg">
</head>

<body>
    <header>
        <div class="logo">
            <a href="../">NoProfits Blog</a>
        </div>
        <nav>
            <a href="../">Home</a>
            <a href="../about.html">About</a>
            <a href="../archive.html">Archive</a>
            <a href="../contact.html">Contact</a>
        </nav>
    </header>

    <main role="main">
        <div class="info">
    <h3>Modern DNS Analysis on macOS - Beyond nslookup</h3>
    Posted on March 19, 2025
    
</div>

<h2 id="abstract">Abstract</h2>
<p>This study examines the evolution of Domain Name System (DNS) query tools on macOS, comparing traditional utilities like <code>nslookup</code> with modern alternatives such as <code>dig</code>. Through systematic testing of various DNS record types (A, MX, NS, SOA, CNAME) on public domains, we demonstrate the enhanced capabilities of contemporary tools in providing detailed resolution data, revealing complex CNAME chains, and offering insights into authoritative responses. The experiments, conducted on macOS in March 2025, highlight significant differences in output format, information detail, and usability between these tools, establishing a foundation for more effective network diagnostics in security-conscious environments.<span class="citation" data-cites="liu2006dns"><sup>1</sup></span></p>
<h2 id="introduction">Introduction</h2>
<p>The Domain Name System (DNS) forms the backbone of Internet navigation, translating human-readable domain names into machine-readable IP addresses. As network complexities increase and security concerns evolve, the tools used to query and troubleshoot DNS have similarly progressed. While <code>nslookup</code> has long served as the standard utility for basic DNS lookups, modern network environments demand more comprehensive analysis capabilities.<span class="citation" data-cites="rfc792"><sup>2</sup></span></p>
<p>This study explores the transition from traditional DNS query tools to contemporary alternatives on macOS, examining their respective strengths, limitations, and practical applications. Our investigation focuses on several key aspects: the richness of information provided, the clarity of output formatting, the ability to reveal complex DNS architectures, and the insights offered regarding authoritative versus non-authoritative responses.</p>
<p>The DNS resolution process involves multiple record types, each serving specific functions in the naming system hierarchy. Understanding these records—from Address (A) records that map domains to IPv4 addresses, to Mail Exchange (MX) records directing email routing, to Start of Authority (SOA) records containing administrative information—is essential for effective network management and troubleshooting.<span class="citation" data-cites="stevens1994tcpip"><sup>3</sup></span></p>
<p>As networks increasingly employ security measures like firewalls and traffic filtering, DNS query tools must adapt to provide meaningful insights despite these constraints. Modern tools like <code>dig</code> (Domain Information Groper) offer enhanced capabilities designed to navigate these challenges, presenting more structured output and detailed resolution information than their predecessors.</p>
<p>Our experimental approach compares the output of <code>nslookup</code> and <code>dig</code> across various record types for common domains like apple.com, examining differences in information presentation, response times, and resolution paths. We also investigate the distinction between authoritative and non-authoritative answers, as well as timeout behaviors that indicate potential network or configuration issues.</p>
<p>The findings from this investigation aim to provide network administrators, security professionals, and technical educators with practical insights into the evolution of DNS diagnostic tools, supporting more effective network management in contemporary computing environments.</p>
<h2 id="experimental">Experimental</h2>
<p>The experiment was conducted on macOS using the Terminal application to execute DNS queries with both traditional <code>nslookup</code> and modern <code>dig</code> commands. All tests were performed in March 2025 using the default DNS resolver configured on the test system (identified as fe80::900e:5cff:fefc:af0e%8#53 in the output).</p>
<p>The following DNS record types were queried for the domain apple.com:</p>
<ol type="1">
<li>A records (IPv4 address mapping)</li>
<li>MX records (Mail Exchange servers)</li>
<li>NS records (Name Servers)</li>
<li>SOA records (Start of Authority)</li>
<li>CNAME records (Canonical Name)</li>
</ol>
<p>For each record type, comparative queries were executed using both <code>nslookup</code> and <code>dig</code> with their respective syntax:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A record queries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> apple.com</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> apple.com A</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># MX record queries</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> <span class="at">-type</span><span class="op">=</span>mx apple.com</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> apple.com MX</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># NS record queries</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> <span class="at">-type</span><span class="op">=</span>ns apple.com</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> apple.com NS</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># SOA record queries</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> <span class="at">-type</span><span class="op">=</span>soa apple.com</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> apple.com SOA</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># CNAME record queries for www subdomain</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> www.apple.com</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> www.apple.com CNAME</span></code></pre></div>
<p>Additionally, to examine authoritative versus non-authoritative responses, the following commands were executed:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Standard query (non-authoritative)</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> apple.com</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Trace query to observe resolution chain</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dig</span> +trace apple.com</span></code></pre></div>
<p>To investigate timeout behaviors, queries were performed for non-existent domains and with invalid DNS servers:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-existent domain query</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> nonexistent-domain-example123456.com</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Query with invalid DNS server</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">nslookup</span> apple.com 192.0.2.1</span></code></pre></div>
<p>Finally, to explore macOS-specific DNS service discovery capabilities, the following commands were used:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># List available DNS service types</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="ex">dns-sd</span> <span class="at">-B</span> _services._dns-sd._udp local.</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Discover HTTP services</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="ex">dns-sd</span> <span class="at">-B</span> _http._tcp local.</span></code></pre></div>
<p>The output from each command was captured and analyzed to compare information content, formatting, response times, and other relevant metrics.</p>
<h2 id="results">Results</h2>
<p><strong>Table 1.</strong> DNS A Record Query Results for apple.com</p>
<table>
<colgroup>
<col style="width: 10%" />
<col style="width: 21%" />
<col style="width: 31%" />
<col style="width: 15%" />
<col style="width: 21%" />
</colgroup>
<thead>
<tr>
<th>Tool</th>
<th>Resolved IP</th>
<th>Response Time / ms</th>
<th>TTL / s</th>
<th>Server Used</th>
</tr>
</thead>
<tbody>
<tr>
<td>nslookup</td>
<td>17.253.144.10</td>
<td>Not provided</td>
<td>Not provided</td>
<td>fe80::900e:5cff:fefc:af0e%8</td>
</tr>
<tr>
<td>dig</td>
<td>17.253.144.10</td>
<td>20</td>
<td>686</td>
<td>fe80::900e:5cff:fefc:af0e%8</td>
</tr>
</tbody>
</table>
<p><strong>Table 2.</strong> MX Record Query Results for apple.com</p>
<table>
<thead>
<tr>
<th>Mail Server</th>
<th>Priority</th>
<th>TTL / s (dig only)</th>
</tr>
</thead>
<tbody>
<tr>
<td>mx-in.g.apple.com</td>
<td>10</td>
<td>3600</td>
</tr>
<tr>
<td>mx-in-ma.apple.com</td>
<td>20</td>
<td>3600</td>
</tr>
<tr>
<td>mx-in-vib.apple.com</td>
<td>20</td>
<td>3600</td>
</tr>
<tr>
<td>mx-in-sg.apple.com</td>
<td>20</td>
<td>3600</td>
</tr>
<tr>
<td>mx-in-rn.apple.com</td>
<td>20</td>
<td>3600</td>
</tr>
<tr>
<td>mx-in-hfd.apple.com</td>
<td>20</td>
<td>3600</td>
</tr>
</tbody>
</table>
<p><strong>Table 3.</strong> Name Server (NS) Records for apple.com</p>
<table>
<thead>
<tr>
<th>Name Server</th>
<th>IPv4 Address</th>
<th>IPv6 Address</th>
<th>TTL / s (dig only)</th>
</tr>
</thead>
<tbody>
<tr>
<td>a.ns.apple.com</td>
<td>17.253.200.1</td>
<td>2620:149:ae0::53</td>
<td>856</td>
</tr>
<tr>
<td>b.ns.apple.com</td>
<td>17.253.207.1</td>
<td>2620:149:ae7::53</td>
<td>856</td>
</tr>
<tr>
<td>c.ns.apple.com</td>
<td>204.19.119.1</td>
<td>2620:171:800:714::1</td>
<td>856</td>
</tr>
<tr>
<td>d.ns.apple.com</td>
<td>204.26.57.1</td>
<td>2620:171:801:714::1</td>
<td>856</td>
</tr>
</tbody>
</table>
<p><strong>Table 4.</strong> Start of Authority (SOA) Record for apple.com</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Value</th>
<th>TTL / s (dig only)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Primary Name Server</td>
<td>ns-ext-prod.jackfruit.apple.com</td>
<td>3596</td>
</tr>
<tr>
<td>Responsible Party</td>
<td>hostmaster.apple.com</td>
<td>-</td>
</tr>
<tr>
<td>Serial Number</td>
<td>2025031900</td>
<td>-</td>
</tr>
<tr>
<td>Refresh Interval / s</td>
<td>900</td>
<td>-</td>
</tr>
<tr>
<td>Retry Interval / s</td>
<td>900</td>
<td>-</td>
</tr>
<tr>
<td>Expire Time / s</td>
<td>2016000</td>
<td>-</td>
</tr>
<tr>
<td>Negative Caching TTL / s</td>
<td>1800</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Table 5.</strong> CNAME Resolution Chain for www.apple.com</p>
<table>
<thead>
<tr>
<th>Resolution Step</th>
<th>Target</th>
<th>TTL / s (dig only)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>www-apple-com.v.aaplimg.com</td>
<td>58</td>
</tr>
<tr>
<td>2</td>
<td>www.apple.com.edgekey.net</td>
<td>220</td>
</tr>
<tr>
<td>3</td>
<td>e6858.dsce9.akamaiedge.net</td>
<td>99</td>
</tr>
<tr>
<td>Final IP</td>
<td>23.206.49.53</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Table 6.</strong> DNS Trace Resolution Path for apple.com</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Server Type</th>
<th>TTL / s</th>
<th>Number of Servers</th>
</tr>
</thead>
<tbody>
<tr>
<td>Root (.)</td>
<td>root-servers.net</td>
<td>58</td>
<td>13</td>
</tr>
<tr>
<td>TLD (com.)</td>
<td>gtld-servers.net</td>
<td>172800</td>
<td>13</td>
</tr>
<tr>
<td>Domain</td>
<td>ns.apple.com</td>
<td>172800 / 43200</td>
<td>4</td>
</tr>
<tr>
<td>Final IP</td>
<td>-</td>
<td>900</td>
<td>-</td>
</tr>
</tbody>
</table>
<p><strong>Table 7.</strong> Error and Timeout Responses</p>
<table>
<colgroup>
<col style="width: 40%" />
<col style="width: 33%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr>
<th>Query Type</th>
<th>Response</th>
<th>Status</th>
</tr>
</thead>
<tbody>
<tr>
<td>Non-existent domain</td>
<td>server can’t find nonexistent-domain-example123456.com</td>
<td>NXDOMAIN</td>
</tr>
<tr>
<td>Invalid DNS server</td>
<td>connection timed out; no servers could be reached</td>
<td>Timeout</td>
</tr>
</tbody>
</table>
<pre><code>Browsing for _services._dns-sd._udp.local.
DATE: ---Wed 19 Mar 2025---
19:19:55.313  ...STARTING...
Timestamp     A/R    Flags  if Domain               Service Type         Instance Name
19:19:55.314  Add        2   8 .                    _tcp.local.          _apple-mobdev2
19:19:55.473  Add        3   1 .                    _tcp.local.          _airplay
19:19:55.473  Add        3   1 .                    _tcp.local.          _raop
[Additional services omitted for brevity]</code></pre>
<p><strong>Figure 1.</strong> Local network service discovery results using dns-sd command on macOS, showing available mDNS services on the local network including Apple ecosystem services (_airplay, _raop) and standard network protocols.</p>
<h2 id="discussion">Discussion</h2>
<p>The comparative analysis of DNS query tools reveals significant differences in information presentation, level of detail, and practical utility between traditional and modern utilities.</p>
<h3 id="information-density-and-presentation">Information Density and Presentation</h3>
<p>Tables 1-5 demonstrate that <code>dig</code> provides more detailed information than <code>nslookup</code> across all record types. While both tools successfully resolve the fundamental DNS data (IP addresses, mail servers, etc.), <code>dig</code> consistently reports additional metrics such as query time, TTL values, and message sizes. This supplementary information is valuable for network diagnostics and performance analysis, particularly when troubleshooting caching issues or connectivity problems.</p>
<p>The TTL values reported by <code>dig</code> (Tables 1-5) reveal Apple’s DNS caching strategy, with short TTLs for frequently changing records like A records (686 seconds) and longer TTLs for more stable infrastructure like MX records (3600 seconds). These values reflect a balance between responsiveness to infrastructure changes and reduction of DNS query load.</p>
<h3 id="resolution-chain-complexity">Resolution Chain Complexity</h3>
<p>The CNAME resolution process documented in Table 5 illustrates the sophisticated content delivery architecture employed by Apple. The multi-step redirection chain (www.apple.com → www-apple-com.v.aaplimg.com → www.apple.com.edgekey.net → e6858.dsce9.akamaiedge.net) reveals Apple’s use of both proprietary CDN infrastructure (aaplimg.com) and third-party services (Akamai’s edgekey.net and akamaiedge.net domains). The progressively declining TTL values across this chain (58s → 220s → 99s) suggest deliberate caching policy differences between the different layers of the architecture.</p>
<p>This complex CNAME chain, clearly visualized through the structured output of <code>dig</code>, demonstrates how modern DNS implementations extend beyond simple domain-to-IP mapping to enable sophisticated content delivery strategies. Understanding these relationships is crucial for network administrators diagnosing web service delivery issues.</p>
<h3 id="authoritative-vs.-non-authoritative-resolution">Authoritative vs. Non-Authoritative Resolution</h3>
<p>The DNS trace results in Table 6 provide insight into the hierarchical nature of DNS resolution, showing the delegation path from root servers through Top-Level Domain (TLD) servers to Apple’s authoritative nameservers. The substantial difference in TTL values between the higher hierarchy levels (172800 seconds for TLD servers) and the final resolution (900 seconds for the A record) reflects the different update frequencies expected at various levels of the DNS tree.</p>
<p>The trace results also reveal NSEC3 records in the response, indicating DNSSEC (DNS Security Extensions) implementation at the .com TLD level. This security measure helps protect against DNS poisoning attacks by providing cryptographic verification of DNS data. The presence of these records, visible only in the <code>dig +trace</code> output, highlights how modern DNS tools can reveal security implementations that remain invisible with traditional utilities.</p>
<h3 id="error-handling-and-diagnostics">Error Handling and Diagnostics</h3>
<p>The error responses documented in Table 7 demonstrate how DNS failures manifest differently depending on their cause. The NXDOMAIN response for non-existent domains provides a clear diagnostic indicator that the domain name itself is invalid, while the connection timeout for queries to an invalid DNS server correctly identifies infrastructure problems rather than domain issues. These distinct error patterns, while visible in both tools, are presented with clearer status codes in the <code>dig</code> output, facilitating more efficient troubleshooting.</p>
<h3 id="local-network-service-integration">Local Network Service Integration</h3>
<p>Figure 1 illustrates capabilities beyond traditional DNS, showing macOS’s integration with Multicast DNS (mDNS) for local service discovery. The presence of Apple-specific services (_airplay, _raop, _companion-link) alongside standard protocols demonstrates how the DNS concept has evolved from simple name resolution to service-oriented discovery. This extension of DNS principles to local network environments represents a significant evolution in network service architecture, enabling zero-configuration networking for modern applications.</p>
<p>The diverse service types discovered on the local network reveal the ubiquity of service advertisement in contemporary computing environments, particularly within the Apple ecosystem. This service-oriented approach to network resource discovery complements traditional DNS by addressing local network needs without requiring centralized infrastructure.</p>
<h2 class="unnumbered" id="references">References</h2>
<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list">
<div id="ref-liu2006dns" class="csl-entry" role="listitem">
<div class="csl-left-margin">1. </div><div class="csl-right-inline">Liu, C.; Albitz, P. <em>DNS and BIND</em>, 5th ed.; O’Reilly Media, 2006.</div>
</div>
<div id="ref-rfc792" class="csl-entry" role="listitem">
<div class="csl-left-margin">2. </div><div class="csl-right-inline">Postel, J. <em><span>Internet Control Message Protocol</span></em>; RFC; 792; RFC Editor, 1981. <a href="https://doi.org/10.17487/RFC0792">https://doi.org/10.17487/RFC0792</a>.</div>
</div>
<div id="ref-stevens1994tcpip" class="csl-entry" role="listitem">
<div class="csl-left-margin">3. </div><div class="csl-right-inline">Stevens, W. R. <em><span>TCP/IP Illustrated, Volume 1: The Protocols</span></em>; Addison-Wesley Professional: Boston, MA, 1994.</div>
</div>
</div>
    </main>

<footer>
    <div class="footer-content">
        <div class="footer-text">
            Site generated by <a href="http://jaspervdj.be/hakyll">Hakyll</a>, authored by <a href="https://noprofits.org">No Profits</a> 
        </br>Select content assisted by <a href="https://www.anthropic.com/claude">Claude</a> - <a href="../colophon.html">Colophon</a>
        </div>
        <div class="print-pdf-button">
            <button onclick="window.print();" class="print-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="print-icon">
                    <polyline points="6 9 6 2 18 2 18 9"></polyline>
                    <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                    <rect x="6" y="14" width="12" height="8"></rect>
                </svg>
                Print / Save as PDF
            </button>
        </div>
    </div>
</footer>
</body>

</html>